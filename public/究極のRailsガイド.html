<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ruby & Rails 学習ガイド - 個人用メモ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Hiragino Sans', sans-serif;
            line-height: 1.7;
            color: #2d3748;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .hero {
            text-align: center;
            color: white;
            padding: 100px 0;
            margin-bottom: 40px;
            position: relative;
            overflow: hidden;
        }
        
        .hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="2" fill="rgba(255,255,255,0.1)"/></svg>') repeat;
            animation: float 20s infinite linear;
        }
        
        @keyframes float {
            0% { transform: translateY(0px) translateX(0px); }
            33% { transform: translateY(-10px) translateX(10px); }
            66% { transform: translateY(10px) translateX(-10px); }
            100% { transform: translateY(0px) translateX(0px); }
        }
        
        .hero h1 {
            font-size: 4.5rem;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            animation: fadeInUp 1s ease-out;
            position: relative;
            z-index: 1;
        }
        
        .hero .subtitle {
            font-size: 1.3rem;
            opacity: 0.9;
            animation: fadeInUp 1s ease-out 0.2s both;
            position: relative;
            z-index: 1;
        }
        
        .hero .ruby-info {
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 30px;
            margin: 40px auto 0;
            max-width: 800px;
            animation: fadeInUp 1s ease-out 0.4s both;
            position: relative;
            z-index: 1;
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .nav-tabs {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 40px 0;
            flex-wrap: wrap;
        }
        
        .nav-tab {
            background: white;
            color: #667eea;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .nav-tab:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.3);
        }
        
        .nav-tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            transform: scale(1.05);
        }
        
        .content-section {
            display: none;
            animation: fadeIn 0.5s ease-in;
        }
        
        .content-section.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .section {
            background: white;
            margin: 30px 0;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .section:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.15);
        }
        
        .section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, #667eea, #764ba2);
        }
        
        h2 {
            color: #1a202c;
            font-size: 2.2rem;
            margin-bottom: 30px;
            border-left: 5px solid #667eea;
            padding-left: 20px;
            position: relative;
        }
        
        h2::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 20px;
            width: 50px;
            height: 3px;
            background: linear-gradient(90deg, #667eea, #764ba2);
            border-radius: 2px;
        }
        
        h3 {
            color: #2d3748;
            font-size: 1.5rem;
            margin: 30px 0 15px 0;
            position: relative;
        }
        
        .concept-box {
            background: linear-gradient(135deg, #e0f2fe 0%, #f3e5f5 100%);
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
            border-left: 5px solid #667eea;
            position: relative;
            overflow: hidden;
        }
        
        .concept-box::before {
            content: '💡';
            font-size: 1.5rem;
            position: absolute;
            top: 15px;
            right: 20px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        .example-box {
            background: linear-gradient(135deg, #f0f9ff 0%, #ecfdf5 100%);
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
            border-left: 5px solid #10b981;
        }
        
        .code-box {
            background: linear-gradient(135deg, #1a202c 0%, #2d3748 100%);
            color: #e2e8f0;
            padding: 25px;
            border-radius: 15px;
            font-family: 'Monaco', 'Menlo', monospace;
            margin: 20px 0;
            overflow-x: auto;
            position: relative;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        .code-box::before {
            content: '';
            position: absolute;
            top: 15px;
            left: 15px;
            width: 12px;
            height: 12px;
            background: #ef4444;
            border-radius: 50%;
            box-shadow: 20px 0 0 #f59e0b, 40px 0 0 #10b981;
        }
        
        .code-box pre {
            margin-top: 30px;
            font-size: 0.95rem;
            line-height: 1.6;
        }
        
        .ruby-highlight {
            background: #cc342d;
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: bold;
        }
        
        .rails-highlight {
            background: #d30001;
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-weight: bold;
        }
        
        .tag-selector {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .tag {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 8px 16px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        .tag:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .tag.active {
            background: linear-gradient(135deg, #f59e0b 0%, #ef4444 100%);
            transform: scale(1.05);
        }
        
        .content-panel {
            display: none;
            padding: 20px;
            background: #f8fafc;
            border-radius: 10px;
            margin: 20px 0;
            animation: fadeIn 0.5s ease-in;
        }
        
        .content-panel.active {
            display: block;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }
        
        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }
        
        th {
            background: linear-gradient(135deg, #4a5568 0%, #2d3748 100%);
            color: white;
            font-weight: 600;
        }
        
        tr:hover {
            background: #f7fafc;
            transition: background 0.3s ease;
        }
        
        .flow-chart {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 15px;
            padding: 30px;
            margin: 20px 0;
            text-align: center;
        }
        
        .flow-item {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 25px;
            border-radius: 25px;
            display: inline-block;
            margin: 10px;
            font-weight: 600;
            transition: transform 0.3s ease;
        }
        
        .flow-item:hover {
            transform: scale(1.05);
        }
        
        .flow-arrow {
            font-size: 30px;
            color: #667eea;
            margin: 10px 0;
            display: block;
            animation: bounce 2s infinite;
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }
        
        .important {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border: 2px solid #f59e0b;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            position: relative;
        }
        
        .important::before {
            content: '⚠️';
            font-size: 1.5rem;
            position: absolute;
            top: 15px;
            right: 20px;
        }
        
        .tip {
            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
            border-left: 5px solid #10b981;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            position: relative;
        }
        
        .tip::before {
            content: '💡';
            font-size: 1.2rem;
            position: absolute;
            top: 15px;
            right: 20px;
        }
        
        .warning {
            background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
            border-left: 5px solid #ef4444;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            position: relative;
        }
        
        .warning::before {
            content: '🚨';
            font-size: 1.2rem;
            position: absolute;
            top: 15px;
            right: 20px;
        }
        
        .pros-cons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }
        
        .pros, .cons {
            padding: 20px;
            border-radius: 10px;
        }
        
        .pros {
            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
            border-left: 5px solid #10b981;
        }
        
        .cons {
            background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%);
            border-left: 5px solid #ef4444;
        }
        
        .badge {
            display: inline-block;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 600;
            margin: 0 5px;
        }
        
        .advanced-badge {
            background: linear-gradient(135deg, #f59e0b 0%, #ef4444 100%);
        }
        
        .beginner-badge {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }
        
        .official-resource {
            background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);
            border: 2px solid #3b82f6;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            position: relative;
        }
        
        .official-resource::before {
            content: '📖';
            font-size: 1.5rem;
            position: absolute;
            top: 15px;
            right: 20px;
        }
        
        .interactive-demo {
            background: linear-gradient(135deg, #f3e8ff 0%, #e9d5ff 100%);
            border: 2px solid #8b5cf6;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }
        
        .demo-button {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            margin: 10px;
        }
        
        .demo-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(139, 92, 246, 0.4);
        }
        
        @media (max-width: 768px) {
            .hero h1 {
                font-size: 2.5rem;
            }
            
            .pros-cons {
                grid-template-columns: 1fr;
            }
            
            .section {
                padding: 20px;
            }
            
            .nav-tabs {
                justify-content: center;
            }
        }
        
        
        .progress-bar {
            position: fixed;
            top: 0;
            left: 0;
            width: 0%;
            height: 4px;
            background: linear-gradient(90deg, #667eea, #764ba2);
            z-index: 1001;
            transition: width 0.3s ease;
        }
    </style>
</head>
<body>
    <div class="progress-bar" id="progressBar"></div>
    
    <div class="container">
        <div class="hero">
            <h1><span class="ruby-highlight">Ruby</span> & <span class="rails-highlight">Rails</span><br>学習ガイド</h1>
            <p class="subtitle">個人的な学習メモ・参考資料集</p>
            
            <div class="ruby-info">
                <h3>🚀 Rubyとは？</h3>
                <p><strong>「プログラマーの親友」</strong> - オープンソースの動的プログラミング言語</p>
                <ul style="text-align: left; margin-top: 15px;">
                    <li>✨ <strong>シンプルさと高い生産性</strong>を備えた言語</li>
                    <li>🎯 <strong>読みやすく、書きやすい</strong>エレガントな文法</li>
                    <li>💎 <strong>プログラマーの幸福</strong>を重視した設計思想</li>
                    <li>🌏 日本生まれの言語で、<strong>グローバルコミュニティ</strong>が活発</li>
                </ul>
                
                <div class="interactive-demo">
                    <h4>🎮 今すぐRubyを試してみよう！</h4>
                    <p>30分でRubyの基礎をマスター</p>
                    <button class="demo-button" onclick="window.open('https://try.ruby-lang.org/', '_blank')">
                        Try Ruby オンライン
                    </button>
                    <button class="demo-button" onclick="showContent('ruby-basics')">
                        基礎文法を学ぶ
                    </button>
                </div>
            </div>
        </div>

        <div class="nav-tabs">
            <div class="nav-tab active" onclick="showMainContent('environment')">環境設定</div>
            <div class="nav-tab" onclick="showMainContent('ruby-intro')">Ruby入門</div>
            <div class="nav-tab" onclick="showMainContent('ruby-syntax')">Ruby文法</div>
            <div class="nav-tab" onclick="showMainContent('rails-basics')">Rails基礎</div>
            <div class="nav-tab" onclick="showMainContent('mvc-deep')">MVC詳解</div>
            <div class="nav-tab" onclick="showMainContent('advanced')">実践テクニック</div>
            <div class="nav-tab" onclick="showMainContent('resources')">学習リソース</div>
            <div class="nav-tab" onclick="showMainContent('testing-tools')">テスト・品質管理</div>
        </div>


        <!-- 環境設定 -->
        <div id="environment" class="content-section active">
            <div class="section">
                <h2>🛠️ 開発環境の準備</h2>
                
                <div class="important">
                    <strong>Windows ユーザーへの重要なアドバイス</strong><br>
                    Windowsで直接Ruby開発すると環境トラブルが多発します。<br>
                    <strong>WSL2 + Ubuntu + VS Code</strong> の組み合わせが最も安定で推奨です！
                </div>

                <h3>🖥️ OS別推奨セットアップ</h3>

                <div class="tag-selector">
                    <div class="tag active" onclick="showEnvContent('windows')">Windows (WSL2)</div>
                    <div class="tag" onclick="showEnvContent('mac')">macOS</div>
                    <div class="tag" onclick="showEnvContent('linux')">Linux</div>
                </div>

                <div id="windows" class="content-panel active">
                    <h4>🔥 Windows + WSL2 セットアップ（推奨）</h4>
                    
                    <div class="warning">
                        <strong>Windows直接インストールはNG！</strong><br>
                        文字化け、パッケージエラー、パフォーマンス問題が頻発します
                    </div>

                    <h5>ステップ1: WSL2 + Ubuntu のインストール</h5>
                    <div class="code-box">
                        <pre>
# PowerShell を管理者権限で実行
wsl --install -d Ubuntu

# 再起動後、Ubuntuを起動してユーザー作成
# ユーザー名とパスワードを設定
                        </pre>
                    </div>

                    <h5>ステップ2: Ubuntu内でRuby環境構築</h5>
                    <div class="code-box">
                        <pre>
# Ubuntuターミナルで実行
sudo apt update
sudo apt upgrade -y

# 必要なパッケージをインストール
sudo apt install -y curl git build-essential libssl-dev libreadline-dev zlib1g-dev

# rbenv（Rubyバージョン管理）をインストール
curl -fsSL https://github.com/rbenv/rbenv-installer/raw/HEAD/bin/rbenv-installer | bash

# パスを通す
echo 'export PATH="$HOME/.rbenv/bin:$PATH"' >> ~/.bashrc
echo 'eval "$(rbenv init -)"' >> ~/.bashrc
source ~/.bashrc

# Ruby 3.4.0 をインストール
rbenv install 3.4.0
rbenv global 3.4.0

# 確認
ruby --version
gem --version
                        </pre>
                    </div>

                    <h5>ステップ3: VS Code + WSL拡張機能</h5>
                    <div class="code-box">
                        <pre>
# 1. VS Code をWindows にインストール
# https://code.visualstudio.com/

# 2. 以下の拡張機能をインストール：
#    - WSL (Microsoft)
#    - Ruby LSP (shopify)
#    - Ruby Solargraph (castwide)

# 3. WSL内のプロジェクトフォルダで：
code .
                        </pre>
                    </div>

                    <div class="tip">
                        <strong>WSL2の利点：</strong><br>
                        • Linux環境でネイティブ動作<br>
                        • Windows上のVS Codeから直接編集<br>
                        • ファイルシステムの互換性問題なし<br>
                        • 本番環境に近い開発体験
                    </div>

                    <div class="section">
                        <h3>⚡ WSL2パフォーマンス最適化</h3>
                        
                        <div class="subsection">
                            <h4>🚨 問題: Windows環境でのRails開発が遅い</h4>
                            <p><strong>症状：</strong></p>
                            <ul>
                                <li>Rubocopの実行に5分以上</li>
                                <li>RSpecの実行に15分以上</li>
                                <li>bin/devの起動が非常に遅い</li>
                                <li>npm install / bundle installが異常に遅い</li>
                            </ul>
                        </div>
                        
                        <div class="subsection">
                            <h4>🔍 なぜWindows側のファイルが遅いのか？</h4>
                            <div class="concept-box">
                                <strong>技術的な原因：</strong>
                                <ul>
                                    <li><strong>ファイルシステム変換</strong>: NTFS（Windows）↔ ext4（Linux）の変換オーバーヘッド</li>
                                    <li><strong>9Pプロトコル</strong>: WSL2は9Pプロトコル経由でWindowsファイルにアクセス（遅い）</li>
                                    <li><strong>メタデータ変換</strong>: 権限、タイムスタンプ、シンボリックリンクの変換コスト</li>
                                    <li><strong>大量ファイル問題</strong>: node_modules、.git、vendorなど数千ファイルへのアクセスで特に顕著</li>
                                </ul>
                                <p style="margin-top: 15px;"><strong>結論：</strong> /mnt/c/配下での開発は避け、WSL2のネイティブファイルシステム（~/）を使用すべき</p>
                            </div>
                        </div>

                        <div class="subsection">
                            <h4>✅ 解決策: プロジェクトをWSL2内のLinuxファイルシステムに移動</h4>
                            
                            <div class="important">
                                <strong>📝 どの段階からでも始められます：</strong><br>
                                • <strong>新規プロジェクト</strong> → Step 1から開始<br>
                                • <strong>既存プロジェクト（Git管理あり）</strong> → Step 2から開始<br>
                                • <strong>既存プロジェクト（Git管理なし）</strong> → Step 3から開始<br>
                                • <strong>問題が起きた場合</strong> → ロールバック手順あり
                            </div>
                            
                            <h5>Step 1: WSL2環境の準備</h5>
                            <pre><code># WSL内でプロジェクト用ディレクトリを作成
mkdir -p ~/projects</code></pre>
                            
                            <h5>Step 2: 既存プロジェクトの移行（推奨：シンボリックリンク方式）</h5>
                            <div class="tip">
                                <strong>🎯 この方法の利点：</strong><br>
                                • 今まで通りのパス（C:\Users\noro\Desktop\...）で作業可能<br>
                                • ショートカットやブックマークを変更する必要なし<br>
                                • 処理速度は大幅に向上<br>
                                • 簡単にロールバック可能
                            </div>

                            <div class="warning">
                                <strong>⚠️ 重要な注意点：</strong><br>
                                • cpコマンドは非常に時間がかかります（数分〜数十分）<br>
                                • rsyncを使用すると高速化されます<br>
                                • コピー中はWindows側ファイルシステムの遅さを実感できます
                            </div>

                            <p><strong>高速コピー（推奨）：</strong></p>
                            <pre><code># rsyncで高速コピー（進捗表示付き）
rsync -av --progress /mnt/c/Users/noro/Desktop/portfolio/RubyPractice/workspace/techlog-app/ ~/projects/techlog-app/

# 権限を修正
cd ~/projects/techlog-app
chmod -R 755 .

# Git設定を調整（改行コード問題回避）
git config core.autocrlf input
git config core.eol lf</code></pre>

                            <p><strong>通常コピー（時間がかかる）：</strong></p>
                            <pre><code># 時間がかかるが確実
cp -r /mnt/c/Users/noro/Desktop/portfolio/RubyPractice/workspace/techlog-app ~/projects/</code></pre>

                            <p><strong>PowerShellを管理者権限で実行：</strong></p>
                            <pre><code># 4. 元のフォルダをバックアップ
Rename-Item "C:\Users\noro\Desktop\portfolio\RubyPractice\workspace\techlog-app" "C:\Users\noro\Desktop\portfolio\RubyPractice\workspace\techlog-app_backup"

# 5. シンボリックリンクを作成（今まで通りのパスで使用可能）
New-Item -ItemType SymbolicLink -Path "C:\Users\noro\Desktop\portfolio\RubyPractice\workspace\techlog-app" -Target "\\wsl$\Ubuntu\home\[WSLユーザー名]\projects\techlog-app"</code></pre>

                            <div class="warning">
                                <strong>⚠️ 重要：</strong> シンボリックリンク作成には管理者権限が必要です。<br>
                                PowerShellを右クリック → 「管理者として実行」で開いてください。
                            </div>

                            <h5>WindowsからWSL内ファイルへのアクセス</h5>
                            <p><strong>エクスプローラーでアクセス：</strong></p>
                            <ul>
                                <li>アドレスバーに <code>\\wsl$</code> と入力</li>
                                <li>または直接 <code>\\wsl$\Ubuntu\home\[username]\projects\rails-app</code></li>
                            </ul>

                            <h5>デスクトップショートカットの作成（PowerShellで実行）</h5>
                            <pre><code>$WshShell = New-Object -comObject WScript.Shell
$Shortcut = $WshShell.CreateShortcut("$Home\Desktop\rails-app.lnk")
$Shortcut.TargetPath = "\\wsl$\Ubuntu\home\[username]\projects\rails-app"
$Shortcut.Save()</code></pre>

                            <h5>📝 エディタ（VS Code/Cursor）での開発</h5>
                            
                            <div class="important">
                                <strong>⚡ 超重要：エディタは必ずWSLモードで開く！</strong><br>
                                エディタの左下に「WSL: Ubuntu」と表示されているか必ず確認してください。<br>
                                これが表示されていないと、せっかくの高速化が無意味になります。
                            </div>

                            <h6>🔰 初心者向け：一番簡単な開き方</h6>
                            <div class="tip">
                                <strong>この方法が最も確実でおすすめ！</strong>
                            </div>
                            <pre><code># 1. WSLターミナルを開く（PowerShellで「wsl」と入力）
# 2. プロジェクトフォルダに移動
cd ~/projects/techlog-app

# 3. エディタを起動（どちらか1つ）
code .   # VS Codeの場合
cursor . # Cursorの場合</code></pre>
                            
                            <p>✅ <strong>成功の確認方法：</strong></p>
                            <ul>
                                <li>エディタの左下に <strong>「WSL: Ubuntu」</strong> と表示される</li>
                                <li>ターミナルを開くと自動的にWSL（bash）になっている</li>
                                <li>ファイルの保存や読み込みが高速</li>
                            </ul>

                            <h6>📚 その他の開き方（参考）</h6>
                            <details>
                                <summary style="cursor: pointer; color: #667eea;">▶ 他の方法を見る（クリックで展開）</summary>
                                
                                <p style="margin-top: 10px;"><strong>方法2: Windowsから開いてWSLに切り替え</strong></p>
                                <ol>
                                    <li>VS Code/Cursorを通常起動</li>
                                    <li><code>Ctrl+Shift+P</code> でコマンドパレットを開く</li>
                                    <li>「Remote-WSL: Open Folder in WSL」を選択</li>
                                    <li><code>~/projects/techlog-app</code> を入力</li>
                                </ol>
                                
                                <p><strong>方法3: Windows側のシンボリックリンクから開く</strong></p>
                                <pre><code># PowerShellで
cd C:\Users\noro\Desktop\portfolio\RubyPractice\workspace\techlog-app
code .  # または cursor .</code></pre>
                                <p>その後、エディタ内で「Reopen in WSL」を選択</p>
                            </details>

                            <h6>❌ よくある間違い（これはダメ！）</h6>
                            <div class="warning">
                                <strong>以下の方法では高速化されません：</strong>
                                <ul>
                                    <li>❌ エクスプローラーから直接 <code>\\wsl$\Ubuntu\...</code> を開く</li>
                                    <li>❌ PowerShellから <code>code \\wsl$\Ubuntu\...</code> と入力</li>
                                    <li>❌ 「WSL: Ubuntu」表示なしで編集を続ける</li>
                                </ul>
                            </div>

                            <h6>🔧 エディタ別の注意点</h6>
                            <div class="concept-box">
                                <p><strong>VS Code：</strong></p>
                                <ul>
                                    <li>WSL拡張機能が必須（Microsoft公式）</li>
                                    <li>自動的にWSLモードに切り替わることが多い</li>
                                    <li>安定性が高い</li>
                                </ul>
                                
                                <p style="margin-top: 15px;"><strong>Cursor：</strong></p>
                                <ul>
                                    <li>VS Codeと同じWSL拡張機能が使える</li>
                                    <li>時々WSLモードへの切り替えが必要</li>
                                    <li>AIアシスタント機能はWSL内でも動作</li>
                                </ul>
                            </div>

                            <h5>エクスプローラーからのターミナル起動</h5>
                            <p><strong>今まで通りの操作で高速化：</strong></p>
                            <ul>
                                <li><code>\\wsl$\Ubuntu\home\[username]\projects\rails-app</code> をエクスプローラーで開く</li>
                                <li><code>Shift + 右クリック</code> → 「Linux シェルをここに開く」</li>
                                <li>自動的に正しいWSLパス（/home/[username]/projects/rails-app）で開く</li>
                                <li>claudeコマンドなども今まで通り使用可能</li>
                            </ul>

                            <h5>Windows Terminal（WSL）の自動起動設定</h5>
                            <p><strong>重要：</strong> Shift+右クリックで確実にWSL/Ubuntuが起動するための設定</p>
                            
                            <p><strong>方法1: Windows Terminalの既定プロファイル設定</strong></p>
                            <ol>
                                <li>Windows Terminalを開く</li>
                                <li><code>Ctrl + ,</code> で設定を開く</li>
                                <li>「スタートアップ」→「既定のプロファイル」を「Ubuntu」に設定</li>
                                <li>これで常にUbuntu（WSL）が起動</li>
                            </ol>

                            <p><strong>方法2: .wslconfigでWSL2の自動起動設定</strong></p>
                            <pre><code># C:\Users\[username]\.wslconfig を作成
[wsl2]
memory=8GB  # メモリ割り当て（任意）
processors=4  # CPU数（任意）

# Windows起動時にWSLを自動起動するタスクスケジューラー設定
# PowerShellを管理者権限で実行：
$trigger = New-ScheduledTaskTrigger -AtLogon
$action = New-ScheduledTaskAction -Execute "wsl.exe" -Argument "echo WSL started"
Register-ScheduledTask -TaskName "Start WSL" -Trigger $trigger -Action $action -RunLevel Highest</code></pre>

                            <p><strong>方法3: レジストリでコンテキストメニューを確実にWSL対応に</strong></p>
                            <pre><code># レジストリエディタで以下を設定（上級者向け）
# HKEY_CLASSES_ROOT\Directory\Background\shell\wt
# 既定値: "ここで開く(&T)"
# コマンド: wt.exe -d "%V"

# またはPowerShellで自動設定：
New-Item -Path "Registry::HKEY_CLASSES_ROOT\Directory\Background\shell\wt" -Force
Set-ItemProperty -Path "Registry::HKEY_CLASSES_ROOT\Directory\Background\shell\wt" -Name "(Default)" -Value "Open WSL here"
New-Item -Path "Registry::HKEY_CLASSES_ROOT\Directory\Background\shell\wt\command" -Force
Set-ItemProperty -Path "Registry::HKEY_CLASSES_ROOT\Directory\Background\shell\wt\command" -Name "(Default)" -Value '"C:\Program Files\WindowsApps\Microsoft.WindowsTerminal_*\wt.exe" -d "%V"'</code></pre>
                        </div>

                        <div class="subsection">
                            <h4>🚀 実測された改善効果</h4>
                            <table style="width: 100%; border-collapse: collapse; margin: 20px 0;">
                                <tr style="background: rgba(255,255,255,0.1);">
                                    <th style="padding: 10px; text-align: left; border: 1px solid rgba(255,255,255,0.2);">タスク</th>
                                    <th style="padding: 10px; text-align: center; border: 1px solid rgba(255,255,255,0.2);">移動前（/mnt/c/）</th>
                                    <th style="padding: 10px; text-align: center; border: 1px solid rgba(255,255,255,0.2);">移動後（~/projects/）</th>
                                    <th style="padding: 10px; text-align: center; border: 1px solid rgba(255,255,255,0.2);">改善倍率</th>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid rgba(255,255,255,0.2);">Rubocop実行</td>
                                    <td style="padding: 10px; text-align: center; border: 1px solid rgba(255,255,255,0.2);">5分以上</td>
                                    <td style="padding: 10px; text-align: center; border: 1px solid rgba(255,255,255,0.2);"><strong>4.008秒</strong></td>
                                    <td style="padding: 10px; text-align: center; border: 1px solid rgba(255,255,255,0.2); color: #4ade80;"><strong>約75倍高速化</strong></td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid rgba(255,255,255,0.2);">Rails server起動</td>
                                    <td style="padding: 10px; text-align: center; border: 1px solid rgba(255,255,255,0.2);">非常に遅い</td>
                                    <td style="padding: 10px; text-align: center; border: 1px solid rgba(255,255,255,0.2);"><strong>1.328秒</strong></td>
                                    <td style="padding: 10px; text-align: center; border: 1px solid rgba(255,255,255,0.2); color: #4ade80;"><strong>即座に起動</strong></td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid rgba(255,255,255,0.2);">RSpec読み込み</td>
                                    <td style="padding: 10px; text-align: center; border: 1px solid rgba(255,255,255,0.2);">15分以上</td>
                                    <td style="padding: 10px; text-align: center; border: 1px solid rgba(255,255,255,0.2);"><strong>0.498秒</strong></td>
                                    <td style="padding: 10px; text-align: center; border: 1px solid rgba(255,255,255,0.2); color: #4ade80;"><strong>約1800倍高速化</strong></td>
                                </tr>
                                <tr>
                                    <td style="padding: 10px; border: 1px solid rgba(255,255,255,0.2);">bin/dev起動</td>
                                    <td style="padding: 10px; text-align: center; border: 1px solid rgba(255,255,255,0.2);">非常に遅い</td>
                                    <td style="padding: 10px; text-align: center; border: 1px solid rgba(255,255,255,0.2);"><strong>約3秒</strong></td>
                                    <td style="padding: 10px; text-align: center; border: 1px solid rgba(255,255,255,0.2); color: #4ade80;"><strong>劇的改善</strong></td>
                                </tr>
                            </table>

                            <div class="concept-box">
                                <strong>📊 実測データから分かること：</strong>
                                <ul>
                                    <li><strong>Rubocop</strong>: 300秒以上 → 4秒（約75倍高速化）</li>
                                    <li><strong>RSpec</strong>: 900秒以上 → 0.5秒（約1800倍高速化）</li>
                                    <li><strong>開発効率</strong>: テスト駆動開発が現実的に</li>
                                    <li><strong>ストレス</strong>: 待機時間がほぼゼロに</li>
                                </ul>
                            </div>
                        </div>

                        <div class="subsection">
                            <h4>💡 追加のTips</h4>
                            <ul>
                                <li><strong>Git管理：</strong> WSL内で <code>git clone</code> し直すことで、改行コードの問題も回避できます</li>
                                <li><strong>データベース：</strong> PostgreSQLやMySQLもWSL内にインストールすることで更に高速化</li>
                                <li><strong>Node.js関連：</strong> <code>npm install</code> や <code>yarn install</code> も劇的に高速化</li>
                                <li><strong>Docker：</strong> Docker DesktopのWSL2バックエンドを有効にすることで、Dockerも高速に</li>
                            </ul>
                        </div>

                        <div class="subsection">
                            <h4>🚨 トラブルシューティング：よくある問題と解決法</h4>
                            
                            <div class="important">
                                <strong>🆘 困った時の最短解決方法</strong><br>
                                複雑な設定で困ったら → <strong>WSL内から直接開く</strong>（確実に動く）<br>
                                <code>cd ~/projects/techlog-app && code .</code> または <code>cursor .</code>
                            </div>

                            <h6>🔧 エディタに関するトラブル</h6>
                            
                            <details style="margin: 10px 0;">
                                <summary style="cursor: pointer; color: #667eea; font-weight: bold;">❓ 左下に「WSL: Ubuntu」が表示されない</summary>
                                <div style="margin: 10px 0; padding: 10px; background: rgba(255,255,255,0.05); border-radius: 5px;">
                                    <p><strong>症状：</strong> エディタは開くが、WSLモードになっていない</p>
                                    <p><strong>解決策：</strong></p>
                                    <ol>
                                        <li><code>Ctrl+Shift+P</code> でコマンドパレット</li>
                                        <li>「Remote-WSL: Reopen Folder in WSL」を選択</li>
                                        <li>または一度エディタを閉じて、WSL内から <code>code .</code> で開き直す</li>
                                    </ol>
                                </div>
                            </details>

                            <details style="margin: 10px 0;">
                                <summary style="cursor: pointer; color: #667eea; font-weight: bold;">❓ Cursorで「WSL: Ubuntu」に切り替わらない</summary>
                                <div style="margin: 10px 0; padding: 10px; background: rgba(255,255,255,0.05); border-radius: 5px;">
                                    <p><strong>症状：</strong> VS Codeは大丈夫だが、Cursorが上手くいかない</p>
                                    <p><strong>解決策：</strong></p>
                                    <ol>
                                        <li>WSL拡張機能をCursorにもインストール</li>
                                        <li>WSL内から直接起動: <code>cursor .</code></li>
                                        <li>設定を一度リセット: <code>Ctrl+,</code> → Remote設定を確認</li>
                                    </ol>
                                </div>
                            </details>

                            <details style="margin: 10px 0;">
                                <summary style="cursor: pointer; color: #667eea; font-weight: bold;">❓ ファイルが見つからない・表示されない</summary>
                                <div style="margin: 10px 0; padding: 10px; background: rgba(255,255,255,0.05); border-radius: 5px;">
                                    <p><strong>症状：</strong> エディタでプロジェクトファイルが表示されない</p>
                                    <p><strong>解決策：</strong></p>
                                    <ol>
                                        <li>正しいパスにいるか確認: <code>pwd</code> コマンドで現在位置を確認</li>
                                        <li>ファイルが実際に存在するか確認: <code>ls -la</code></li>
                                        <li>エディタのワークスペースをリロード: <code>Ctrl+Shift+P</code> → 「Developer: Reload Window」</li>
                                    </ol>
                                </div>
                            </details>

                            <h6>⚙️ システム・環境に関するトラブル</h6>
                            
                            <details style="margin: 10px 0;">
                                <summary style="cursor: pointer; color: #ef4444; font-weight: bold;">🔥 Input/output error が発生</summary>
                                <div style="margin: 10px 0; padding: 10px; background: rgba(255,255,255,0.05); border-radius: 5px;">
                                    <p><strong>症状：</strong> <code>cd techlog-app</code> で「Input/output error」</p>
                                    <p><strong>原因：</strong> シンボリックリンクが壊れている</p>
                                    <p><strong>解決策：</strong></p>
                                    <pre style="background: #2d3748; color: #e2e8f0; padding: 10px; border-radius: 5px; overflow-x: auto;"><code># PowerShell（管理者権限）で実行
# 1. 現在の状況を確認
Get-ChildItem "C:\Users\noro\Desktop\portfolio\RubyPractice\workspace\" | Format-Table

# 2. 壊れたシンボリックリンクを削除
Remove-Item "C:\Users\noro\Desktop\portfolio\RubyPractice\workspace\techlog-app" -Force

# 3. 新しく作り直す
New-Item -ItemType SymbolicLink -Path "C:\Users\noro\Desktop\portfolio\RubyPractice\workspace\techlog-app" -Target "\\wsl$\Ubuntu\home\noro\projects\techlog-app"</code></pre>
                                    <p><strong>🚀 確実な回避方法：</strong> WSL内のプロジェクト <code>~/projects/techlog-app</code> を直接使う</p>
                                </div>
                            </details>

                            <details style="margin: 10px 0;">
                                <summary style="cursor: pointer; color: #ef4444; font-weight: bold;">🔥 PowerShellで「~」が効かない</summary>
                                <div style="margin: 10px 0; padding: 10px; background: rgba(255,255,255,0.05); border-radius: 5px;">
                                    <p><strong>症状：</strong> <code>cd ~/projects</code> で「パスが見つかりません」</p>
                                    <p><strong>原因：</strong> PowerShellとbashでパスの表記が違う</p>
                                    <p><strong>解決策：</strong></p>
                                    <ul>
                                        <li><strong>PowerShell：</strong> <code>cd C:\Users\noro\Desktop\...</code> （フルパス）</li>
                                        <li><strong>WSL/bash：</strong> <code>cd ~/projects/...</code> （~ 記法）</li>
                                        <li><strong>推奨：</strong> WSLターミナルを使う（<code>wsl</code> コマンドで起動）</li>
                                    </ul>
                                </div>
                            </details>

                            <h6>🔄 完全にやり直したい場合</h6>
                            <details style="margin: 10px 0;">
                                <summary style="cursor: pointer; color: #f59e0b; font-weight: bold;">⚠️ 設定を完全リセットする手順</summary>
                                <div style="margin: 10px 0; padding: 10px; background: rgba(255,255,255,0.05); border-radius: 5px;">
                                    <p><strong>注意：</strong> 以下を実行すると設定が初期状態に戻ります</p>
                                    <pre style="background: #2d3748; color: #e2e8f0; padding: 10px; border-radius: 5px; overflow-x: auto;"><code># 1. WSL内のプロジェクトを削除（必要に応じて）
rm -rf ~/projects/techlog-app

# 2. PowerShell（管理者権限）でシンボリックリンクを削除
Remove-Item "C:\Users\noro\Desktop\portfolio\RubyPractice\workspace\techlog-app"

# 3. バックアップから復元
Rename-Item "C:\Users\noro\Desktop\portfolio\RubyPractice\workspace\techlog-app_backup" "techlog-app"</code></pre>
                                    <p>その後、最初からセットアップを行ってください。</p>
                                </div>
                            </details>

                            <div class="tip" style="margin-top: 20px;">
                                <strong>💡 トラブルを避けるコツ</strong><br>
                                • <strong>迷ったらWSL内から開く：</strong> <code>cd ~/projects/techlog-app && code .</code><br>
                                • <strong>左下の表示を確認：</strong> 「WSL: Ubuntu」があることを必ず確認<br>
                                • <strong>パスの混同を避ける：</strong> PowerShellでは <code>C:\...</code>、WSLでは <code>~/</code> を使う<br>
                                • <strong>困ったときは：</strong> エディタを一度閉じて、WSL内から開き直す
                            </div>
                        </div>
                        
                        <div class="subsection">
                            <h4>✅ 動作確認とパフォーマンステスト</h4>
                            <pre><code># WSL内で動作確認
cd ~/projects/techlog-app

# bundlerとnpmパッケージを再インストール
bundle install
npm install

# Rubocopの実行時間を計測
time bundle exec rubocop

# サーバー起動
bin/dev</code></pre>
                            
                            <div class="tip">
                                <strong>VS Codeの推奨設定：</strong><br>
                                WSL内から開く: <code>cd ~/projects/techlog-app && code .</code><br>
                                または Windows側から: <code>Ctrl+Shift+P</code> → <code>Remote-WSL: Open Folder in WSL</code>
                            </div>
                        </div>

                        <div class="subsection">
                            <h4>⚠️ 注意事項</h4>
                            <ul>
                                <li><strong>管理者権限：</strong> シンボリックリンク作成時のみ必要（その後は通常権限でOK）</li>
                                <li><strong>WSL拡張機能：</strong> VS Code以外のエディタを使う場合はWSL対応の確認が必要</li>
                                <li><strong>バックアップ：</strong> 定期的にWSL内のファイルもバックアップすることを推奨</li>
                                <li><strong>データベース：</strong> PostgreSQL/MySQLもWSL内にインストールすると更に高速化</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <div id="mac" class="content-panel">
                    <h4>🍎 macOS セットアップ</h4>
                    
                    <h5>Homebrew経由でのインストール（推奨）</h5>
                    <div class="code-box">
                        <pre>
# Homebrewがない場合はインストール
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"

# rbenvでRubyを管理
brew install rbenv ruby-build

# パスを通す
echo 'export PATH="$HOME/.rbenv/bin:$PATH"' >> ~/.zshrc
echo 'eval "$(rbenv init -)"' >> ~/.zshrc
source ~/.zshrc

# Ruby 3.4.0 をインストール
rbenv install 3.4.0
rbenv global 3.4.0

# Git & VS Code
brew install git
brew install --cask visual-studio-code

# 確認
ruby --version
git --version
                        </pre>
                    </div>
                </div>

                <div id="linux" class="content-panel">
                    <h4>🐧 Linux セットアップ</h4>
                    
                    <div class="code-box">
                        <pre>
# Ubuntu/Debian系
sudo apt update
sudo apt install -y curl git build-essential libssl-dev libreadline-dev zlib1g-dev

# rbenvインストール
curl -fsSL https://github.com/rbenv/rbenv-installer/raw/HEAD/bin/rbenv-installer | bash

# パスを通す
echo 'export PATH="$HOME/.rbenv/bin:$PATH"' >> ~/.bashrc
echo 'eval "$(rbenv init -)"' >> ~/.bashrc
source ~/.bashrc

# Ruby 3.4.0 をインストール
rbenv install 3.4.0
rbenv global 3.4.0

# VS Code（Snap版）
sudo snap install code --classic
                        </pre>
                    </div>
                </div>

                <h3>✅ セットアップ完了チェック</h3>
                <div class="code-box">
                    <pre>
# これらのコマンドが正常に動作すればOK
ruby --version    # Ruby 3.4.0
gem --version     # RubyGems のバージョン
git --version     # Git のバージョン
code --version    # VS Code のバージョン

# Hello World で動作確認
echo "puts 'Hello, Ruby!'" > hello.rb
ruby hello.rb
                    </pre>
                </div>

                <div class="important">
                    <strong>トラブル時の対処法：</strong><br>
                    • Windows: WSL2が正しく有効化されているか確認<br>
                    • macOS: Command Line Tools がインストール済みか確認<br>
                    • 全OS: rbenv の PATH設定が正しいか確認
                </div>
            </div>
        </div>

        <!-- Ruby入門 -->
        <div id="ruby-intro" class="content-section">
            <div class="section">
                <h2>💎 Ruby入門</h2>
                
                <div class="concept-box">
                    <h3>なぜRubyを学ぶべきか？</h3>
                    <p><strong>「手を動かしながら学ぶのが一番！」</strong></p>
                    <p>環境が整ったので、今度はRubyの素晴らしさを理解しましょう。Rubyは「プログラマーの幸福」を最優先に設計された言語です。</p>
                </div>
                
                <div class="concept-box">
                    <h3>Rubyの設計思想</h3>
                    <p><strong>「美しさはシンプルさと力強さの中にある」</strong></p>
                    <ul>
                        <li>🎯 <strong>プログラマーの幸福</strong>を最優先</li>
                        <li>📖 <strong>自然な読みやすさ</strong>を重視</li>
                        <li>⚡ <strong>高い生産性</strong>を実現</li>
                        <li>🌈 <strong>表現の自由度</strong>が高い</li>
                    </ul>
                </div>

                <h3>Rubyが愛される理由</h3>
                <div class="example-box">
                    <h4>🚀 他言語との比較</h4>
                    <div class="code-box">
                        <pre>
# Java（冗長）
public class HelloWorld {
    public static void main(String[] args) {
        System.out.println("Hello, World!");
    }
}

# Ruby（簡潔）
puts "Hello, World!"

# 配列の操作
# Java
for(int i = 0; i < numbers.length; i++) {
    if(numbers[i] % 2 == 0) {
        System.out.println(numbers[i] * 2);
    }
}

# Ruby（読みやすい）
numbers.select(&:even?).map { |n| n * 2 }.each { |n| puts n }
                        </pre>
                    </div>
                </div>

                <div class="official-resource" id="getting-started">
                    <h3>📚 公式学習リソース</h3>
                    <ul>
                        <li><strong><a href="https://try.ruby-lang.org/" target="_blank">Try Ruby</a></strong> - 30分でRubyをマスター</li>
                        <li><strong><a href="https://www.ruby-lang.org/ja/documentation/" target="_blank">公式ドキュメント</a></strong> - 詳細な文法リファレンス</li>
                        <li><strong>20分ではじめるRuby</strong> - クイックスタートガイド</li>
                        <li><strong>他言語からのRuby入門</strong> - 経験者向け移行ガイド</li>
                    </ul>
                    
                    <div class="tip">
                        <strong>推奨学習ステップ：</strong><br>
                        1. Try Rubyで体験 → 2. 基本文法を学習 → 3. 小さなプログラムを作成 → 4. Railsに挑戦
                    </div>
                </div>
                
                <div style="text-align: center; margin-top: 30px;">
                    <button onclick="showMainContent('ruby-syntax')" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 12px 24px; border-radius: 25px; font-size: 16px; cursor: pointer; transition: all 0.3s ease;">
                        次へ →
                    </button>
                </div>
            </div>
        </div>

        <!-- Ruby文法 -->
        <div id="ruby-syntax" class="content-section">
            <div class="section" id="syntax-basics">
                <h2>💎 Ruby文法完全リファレンス</h2>
                
                <div class="tag-selector">
                    <div class="tag active" onclick="showRubyContent('variables')">変数・定数</div>
                    <div class="tag" onclick="showRubyContent('methods')">メソッド</div>
                    <div class="tag" onclick="showRubyContent('blocks')">ブロック・イテレータ</div>
                    <div class="tag" onclick="showRubyContent('classes')">クラス・モジュール</div>
                    <div class="tag" onclick="showRubyContent('collections')">配列・ハッシュ</div>
                    <div class="tag" onclick="showRubyContent('symbols')">シンボル</div>
                    <div class="tag" onclick="showRubyContent('control')">制御構文</div>
                    <div class="tag" onclick="showRubyContent('advanced-ruby')">応用技術</div>
                </div>

                <div id="variables" class="content-panel active">
                    <h4>変数・定数の完全ガイド</h4>
                    <div class="code-box">
                        <pre>
# ローカル変数（小文字またはアンダースコア始まり）
name = "太郎"
age = 25
user_name = "taro"

# インスタンス変数（@で始まる）
class User
  def initialize(name)
    @name = name  # インスタンス変数
  end
  
  def greet
    "Hello, #{@name}!"  # 他のメソッドからもアクセス可能
  end
end

# クラス変数（@@で始まる）
class User
  @@count = 0  # クラス変数
  
  def initialize(name)
    @name = name
    @@count += 1
  end
  
  def self.total_users
    @@count
  end
end

# 定数（大文字で始まる）
MAX_USERS = 100
API_ENDPOINT = "https://api.example.com"

# グローバル変数（$で始まる） ※非推奨
$global_var = "避けるべき"

# 多重代入（便利な機能）
a, b, c = [1, 2, 3]           # a=1, b=2, c=3
first, *rest = [1, 2, 3, 4]   # first=1, rest=[2,3,4]
x, y = y, x                   # 値の交換

# 範囲（Range）
(1..10).each { |i| puts i }   # 1から10まで（10を含む）
(1...10).each { |i| puts i }  # 1から10未満（10を含まない）
                        </pre>
                    </div>
                    
                    <div class="tip">
                        <strong>命名規則：</strong><br>
                        • 変数・メソッド：snake_case<br>
                        • 定数・クラス：UPPER_CASE / PascalCase<br>
                        • 述語メソッド：末尾に?<br>
                        • 破壊的メソッド：末尾に!
                    </div>
                </div>

                <div id="methods" class="content-panel">
                    <h4>メソッド定義の全パターン</h4>
                    <div class="code-box">
                        <pre>
# 基本的なメソッド
def greet(name)
  "Hello, #{name}!"
end

# デフォルト引数
def greet(name = "World")
  "Hello, #{name}!"
end

# キーワード引数（Ruby 2.0+）
def create_user(name:, email:, age: 20)
  { name: name, email: email, age: age }
end

# 必須キーワード引数（Ruby 2.1+）
def login(email:, password:)
  # email と password は必須
end

# 可変長引数
def sum(*numbers)
  numbers.sum
end

def info(name, *hobbies, **details)
  puts "Name: #{name}"
  puts "Hobbies: #{hobbies.join(', ')}"
  puts "Details: #{details}"
end

# 使用例
info("太郎", "読書", "映画", age: 25, city: "東京")

# ブロックを受け取るメソッド
def with_timing
  start_time = Time.now
  result = yield  # ブロックを実行
  puts "実行時間: #{Time.now - start_time}秒"
  result
end

# 使用例
with_timing do
  sleep(1)
  "完了しました"
end

# 述語メソッド（真偽値を返す）
def admin?
  @role == 'admin'
end

def empty?
  @items.nil? || @items.empty?
end

# 破壊的メソッド（オブジェクトを変更）
def upcase!
  @name = @name.upcase
end

# エイリアス
alias_method :hello, :greet
                        </pre>
                    </div>
                </div>

                <div id="blocks" class="content-panel">
                    <h4>ブロック・イテレータ・Proc</h4>
                    <div class="code-box">
                        <pre>
# ブロックの基本形
[1, 2, 3].each do |num|
  puts num * 2
end

# 1行の場合は {} を使用（慣習）
[1, 2, 3].each { |num| puts num * 2 }

# よく使うイテレータ
numbers = [1, 2, 3, 4, 5]

# map: 変換
squared = numbers.map { |n| n ** 2 }  # [1, 4, 9, 16, 25]

# select: フィルタリング
evens = numbers.select { |n| n.even? }  # [2, 4]

# reject: 除外
odds = numbers.reject { |n| n.even? }   # [1, 3, 5]

# find: 最初にマッチするもの
first_even = numbers.find { |n| n.even? }  # 2

# reduce/inject: 畳み込み
total = numbers.reduce(0) { |sum, n| sum + n }  # 15
total = numbers.sum  # 上記の短縮形

# each_with_index: インデックス付き
["a", "b", "c"].each_with_index do |char, index|
  puts "#{index}: #{char}"
end

# Proc オブジェクト
doubler = Proc.new { |x| x * 2 }
tripler = proc { |x| x * 3 }  # proc は Proc.new の省略形

numbers.map(&doubler)  # [2, 4, 6, 8, 10]

# Lambda
multiply = ->(x, y) { x * y }
multiply.call(3, 4)  # 12

# Symbol to Proc（魔法の記法）
["apple", "banana"].map(&:upcase)  # ["APPLE", "BANANA"]
[1, 2, 3].map(&:to_s)              # ["1", "2", "3"]

# with_index
["a", "b", "c"].map.with_index { |char, i| "#{i}:#{char}" }

# チェインメソッド
result = [1, 2, 3, 4, 5]
  .select(&:even?)      # [2, 4]
  .map { |n| n * 3 }    # [6, 12]
  .sum                  # 18
                        </pre>
                    </div>
                    
                    <div class="important">
                        <strong>ブロック vs Proc vs Lambda：</strong><br>
                        • ブロック：メソッドに渡す処理の塊<br>
                        • Proc：ブロックをオブジェクト化<br>
                        • Lambda：より厳密なProc（引数チェックあり）
                    </div>
                </div>

                <div id="classes" class="content-panel">
                    <h4>クラス・モジュールの設計</h4>
                    <div class="code-box">
                        <pre>
# 基本的なクラス
class User
  # アクセサーメソッド
  attr_reader :name      # getter のみ
  attr_writer :email     # setter のみ
  attr_accessor :age     # getter と setter

  # クラス変数
  @@user_count = 0

  # 初期化メソッド
  def initialize(name, email)
    @name = name
    @email = email
    @created_at = Time.now
    @@user_count += 1
  end

  # インスタンスメソッド
  def introduce
    "私は#{@name}です。#{@email}でご連絡ください。"
  end

  def age_in_days
    (Time.now - @created_at) / (24 * 60 * 60)
  end

  # クラスメソッド
  def self.total_count
    @@user_count
  end

  def self.create_guest
    new("ゲスト", "guest@example.com")
  end

  # プライベートメソッド
  private

  def validate_email
    @email.include?('@')
  end

  def format_name
    @name.strip.capitalize
  end
end

# 継承
class AdminUser < User
  def initialize(name, email, permissions = [])
    super(name, email)  # 親のinitializeを呼び出し
    @permissions = permissions
  end

  def can?(action)
    @permissions.include?(action)
  end

  # メソッドのオーバーライド
  def introduce
    "管理者の#{@name}です。"
  end
end

# モジュール（Mix-in）
module Loggable
  def log(message)
    puts "[#{Time.now}] #{self.class}: #{message}"
  end

  def debug(message)
    log("DEBUG: #{message}") if ENV['DEBUG']
  end
end

module Comparable
  def <=>(other)
    self.score <=> other.score
  end
end

class Player
  include Loggable     # インスタンスメソッドとして追加
  include Comparable   # 比較可能にする

  attr_accessor :name, :score

  def initialize(name, score)
    @name = name
    @score = score
  end
end

# extend（クラスメソッドとして追加）
class Logger
  extend Loggable
end

Logger.log("アプリケーション開始")  # クラスメソッドとして使用

# 特異メソッド（オブジェク個別のメソッド）
user = User.new("太郎", "taro@example.com")
def user.special_greeting
  "特別な#{@name}です！"
end
                        </pre>
                    </div>
                </div>

                <div id="collections" class="content-panel">
                    <h4>配列・ハッシュ完全操作ガイド</h4>
                    <div class="code-box">
                        <pre>
# 配列の作成と基本操作
arr = [1, 2, 3, 4, 5]
arr = Array.new(5, 0)        # [0, 0, 0, 0, 0]
arr = Array(1..5)            # [1, 2, 3, 4, 5]

# 要素の追加・削除
arr << 6                     # 末尾に追加
arr.push(7, 8)              # 複数追加
arr.unshift(0)              # 先頭に追加
arr.insert(2, 'inserted')    # 指定位置に挿入

last = arr.pop              # 末尾から削除して取得
first = arr.shift           # 先頭から削除して取得
arr.delete_at(2)            # 指定位置を削除
arr.delete('inserted')       # 指定値を削除

# 便利なメソッド
arr.first                   # 最初の要素
arr.last                    # 最後の要素
arr.sample                  # ランダムな要素
arr.shuffle                 # シャッフルした新しい配列
arr.reverse                 # 逆順の新しい配列
arr.sort                    # ソートした新しい配列
arr.uniq                    # 重複を除いた新しい配列

# 配列の検索・判定
arr.include?(3)             # 要素が含まれるか
arr.index(3)                # 要素のインデックス
arr.empty?                  # 空かどうか
arr.length                  # 要素数（arr.size でも同じ）

# ハッシュの作成と操作
hash = { name: "太郎", age: 25 }
hash = Hash.new("default")   # デフォルト値付き

# アクセス方法
hash[:name]                 # シンボルキー
hash["name"]                # 文字列キー（別のキー扱い）
hash.fetch(:name, "unknown") # デフォルト値付きアクセス

# 要素の追加・更新・削除
hash[:city] = "東京"         # 追加
hash[:age] = 26             # 更新
hash.store(:hobby, "読書")   # store メソッド
hash.delete(:age)           # 削除

# 便利なメソッド
hash.keys                   # キーの配列
hash.values                 # 値の配列
hash.has_key?(:name)        # キーの存在確認
hash.has_value?("太郎")      # 値の存在確認
hash.empty?                 # 空かどうか
hash.length                 # 要素数

# マージ
other = { job: "エンジニア", city: "大阪" }
hash.merge(other)           # 新しいハッシュを返す
hash.merge!(other)          # 破壊的マージ

# イテレーション
hash.each { |key, value| puts "#{key}: #{value}" }
hash.each_key { |key| puts key }
hash.each_value { |value| puts value }

# 変換
hash.to_a                   # [[key, value], ...] の配列
hash.invert                 # キーと値を入れ替え

# ネストしたハッシュ
nested = {
  user: {
    name: "太郎",
    profile: {
      age: 25,
      hobbies: ["読書", "映画"]
    }
  }
}

# dig メソッドで安全にアクセス（Ruby 2.3+）
age = nested.dig(:user, :profile, :age)  # 25
missing = nested.dig(:user, :missing, :key)  # nil（エラーにならない）
                        </pre>
                    </div>
                </div>

                <div id="symbols" class="content-panel">
                    <h4>シンボル完全理解</h4>
                    <div class="code-box">
                        <pre>
# シンボルとは？
# - 不変な識別子（文字列のようなもの）
# - 同じシンボルは常に同一オブジェクト
# - メモリ効率が良い
# - ハッシュのキーに最適

# 文字列との違い
"hello".object_id    # 毎回異なるID
"hello".object_id    # 毎回異なるID

:hello.object_id     # 常に同じID
:hello.object_id     # 常に同じID

# シンボルの作成方法
:symbol              # 基本形
:"with spaces"       # スペースを含む
:"#{variable}"       # 動的生成（非推奨）

# よく使われる場面
# 1. ハッシュのキー
user = { 
  name: "太郎",      # :name => "太郎" と同じ
  age: 25,           # :age => 25 と同じ
  email: "taro@example.com"
}

# 2. メソッドの引数
attr_accessor :name, :email, :age
validates :email, presence: true, uniqueness: true

# 3. 状態の表現
status = :active     # :pending, :inactive など

case status
when :active
  "利用中"
when :pending
  "保留中"
when :inactive
  "停止中"
end

# 4. メタプログラミング
class User
  [:name, :email, :age].each do |attr|
    define_method(attr) do
      instance_variable_get("@#{attr}")
    end
    
    define_method("#{attr}=") do |value|
      instance_variable_set("@#{attr}", value)
    end
  end
end

# 相互変換
:symbol.to_s         # "symbol"
"string".to_sym      # :string
"string".intern      # :string（to_sym のエイリアス）

# Symbol#to_proc の魔法
["apple", "banana", "cherry"].map(&:upcase)
# 上記は下記と同じ意味
["apple", "banana", "cherry"].map { |str| str.upcase }

# 数値でも動作
[1, 2, 3].map(&:to_s)        # ["1", "2", "3"]
[1.5, 2.7, 3.9].map(&:to_i)  # [1, 2, 3]

# チェーンも可能
["  hello  ", "  world  "].map(&:strip).map(&:capitalize)
# ["Hello", "World"]

# 注意点：メモリリーク
# 動的にシンボルを大量生成するとGCされないので注意
user_input = "dynamic_symbol"
user_input.to_sym  # 悪い例：ユーザー入力からシンボル生成

# 良い例：事前定義されたシンボルを使用
VALID_STATUSES = [:active, :inactive, :pending].freeze
status = :active if VALID_STATUSES.include?(:active)
                        </pre>
                    </div>
                    
                    <div class="warning">
                        <strong>シンボルの注意点：</strong><br>
                        動的にシンボルを大量作成するとメモリリークの原因になります。<br>
                        ユーザー入力から直接シンボルを作らないよう注意！
                    </div>
                </div>

                <div id="control" class="content-panel">
                    <h4>制御構文の全パターン</h4>
                    <div class="code-box">
                        <pre>
# if文の各種形式
if condition
  # 処理
elsif other_condition
  # 処理
else
  # 処理
end

# 後置if（修飾子）
puts "Hello" if greeting_enabled
return false unless valid?

# 三項演算子
result = condition ? "真" : "偽"
status = user.active? ? "アクティブ" : "非アクティブ"

# unless（if の逆）
unless user.admin?
  redirect_to root_path
end

# case文
case status
when "draft"
  "下書き"
when "published", "public"  # 複数条件
  "公開中"
when /^archived/            # 正規表現
  "アーカイブ"
else
  "不明"
end

# case で範囲を使用
case score
when 0...60
  "不可"
when 60...70
  "可"
when 70...80
  "良"
when 80..100
  "優"
else
  "範囲外"
end

# while ループ
i = 0
while i < 10
  puts i
  i += 1
end

# until ループ（while の逆）
i = 0
until i >= 10
  puts i
  i += 1
end

# for ループ（あまり使わない）
for i in 1..10
  puts i
end

# break と next
(1..10).each do |i|
  next if i.even?  # continue相当
  break if i > 7   # break
  puts i
end

# イテレータ系（よく使う）
5.times do |i|
  puts i  # 0から4まで
end

1.upto(5) { |i| puts i }      # 1から5まで
5.downto(1) { |i| puts i }    # 5から1まで

# step
1.step(10, 2) { |i| puts i }  # 1, 3, 5, 7, 9

# loop（無限ループ）
loop do
  input = gets.chomp
  break if input == "exit"
  puts "入力: #{input}"
end

# 例外処理
begin
  # 危険な処理
  file = File.open("nonexistent.txt")
rescue Errno::ENOENT => e
  puts "ファイルが見つかりません: #{e.message}"
rescue StandardError => e
  puts "エラーが発生しました: #{e.message}"
else
  # 例外が発生しなかった場合
  puts "ファイル読み込み成功"
ensure
  # 必ず実行される
  file&.close
  puts "処理完了"
end

# raise で例外を発生
def divide(a, b)
  raise ArgumentError, "ゼロ除算はできません" if b.zero?
  a / b
end

# カスタム例外
class MyCustomError < StandardError; end

def risky_operation
  raise MyCustomError, "カスタムエラーが発生"
end
                        </pre>
                    </div>
                </div>

                <div id="advanced-ruby" class="content-panel">
                    <h4>Ruby応用技術</h4>
                    <div class="code-box">
                        <pre>
# メタプログラミング基礎
class User
  # 動的メソッド定義
  [:name, :email, :age].each do |attr|
    define_method(attr) do
      instance_variable_get("@#{attr}")
    end
    
    define_method("#{attr}=") do |value|
      instance_variable_set("@#{attr}", value)
    end
  end
end

# method_missing（存在しないメソッドの処理）
class DynamicAccessor
  def initialize(data)
    @data = data
  end
  
  def method_missing(method_name, *args, &block)
    if @data.key?(method_name)
      @data[method_name]
    elsif method_name.to_s.end_with?('=')
      attr_name = method_name.to_s.chomp('=').to_sym
      @data[attr_name] = args.first
    else
      super
    end
  end
  
  def respond_to_missing?(method_name, include_private = false)
    @data.key?(method_name) || method_name.to_s.end_with?('=') || super
  end
end

user = DynamicAccessor.new({})
user.name = "太郎"
puts user.name  # "太郎"

# send（メソッドを動的実行）
class Calculator
  def add(a, b)
    a + b
  end
  
  def multiply(a, b)
    a * b
  end
end

calc = Calculator.new
operation = "add"
result = calc.send(operation, 5, 3)  # 8

# const_get（定数を動的取得）
class_name = "String"
klass = Object.const_get(class_name)  # String クラス
instance = klass.new("Hello")

# eval系（注意して使用）
code = "puts 'Hello from eval'"
eval(code)  # 文字列をRubyコードとして実行

# instance_eval（オブジェクトのコンテキストで実行）
user = User.new("太郎")
user.instance_eval do
  @secret = "秘密の情報"
  puts @name  # "太郎"
end

# class_eval（クラスのコンテキストで実行）
User.class_eval do
  def special_method
    "特別なメソッド"
  end
end

# Module#prepend（メソッドの前に割り込み）
module Loggable
  def save
    puts "保存前処理"
    super  # 元のメソッドを呼び出し
    puts "保存後処理"
  end
end

class User
  prepend Loggable  # include より先に実行される
  
  def save
    puts "実際の保存処理"
  end
end

User.new.save
# 出力:
# 保存前処理
# 実際の保存処理
# 保存後処理

# Refinements（限定的な拡張）
module StringExtensions
  refine String do
    def palindrome?
      self == self.reverse
    end
  end
end

class PalindromeChecker
  using StringExtensions  # このクラス内でのみ有効
  
  def check(str)
    str.palindrome?
  end
end

# Fiber（軽量スレッド）
fiber = Fiber.new do
  puts "Fiber開始"
  Fiber.yield "一時停止"
  puts "Fiber再開"
  "終了"
end

puts fiber.resume  # "Fiber開始" と "一時停止" が出力
puts fiber.resume  # "Fiber再開" と "終了" が出力

# Enumerator（遅延評価）
enum = (1..Float::INFINITY).lazy
         .select(&:even?)
         .map { |n| n * 2 }
         .first(10)  # 最初の10個だけ評価

puts enum  # [4, 8, 12, 16, 20, 24, 28, 32, 36, 40]
                        </pre>
                    </div>
                    
                    <div class="warning">
                        <strong>メタプログラミングの注意点：</strong><br>
                        • eval系は特にセキュリティリスクが高い<br>
                        • method_missing は respond_to_missing? とセットで定義<br>
                        • 過度な動的プログラミングはデバッグを困難にする
                    </div>
                </div>
            </div>
        </div>

        <!-- Rails基礎 -->
        <div id="rails-basics" class="content-section">
            <div class="section" id="rails-intro">
                <h2>🚄 Rails入門 - Webフレームワークの世界</h2>
                
                <div class="concept-box">
                    <h3>Railsとは？</h3>
                    <p><strong>Ruby on Rails</strong> = 高速なWebアプリケーション開発のためのフレームワーク</p>
                    <ul>
                        <li>🍛 <strong>カレーのルー</strong>のような存在（基本機能は用意済み）</li>
                        <li>📋 <strong>設定より規約</strong>（Convention over Configuration）</li>
                        <li>🔄 <strong>DRY原則</strong>（Don't Repeat Yourself）</li>
                        <li>🎯 <strong>RESTful設計</strong>を標準サポート</li>
                    </ul>
                </div>

                <div class="example-box">
                    <h4>🍛 フレームワークの比喩</h4>
                    <p><strong>カレーを作るとき</strong></p>
                    <div class="pros-cons">
                        <div class="cons">
                            <h5>❌ スパイスから調合（フレームワークなし）</h5>
                            <ul>
                                <li>自由度は高い</li>
                                <li>時間がかかる</li>
                                <li>失敗のリスク</li>
                                <li>毎回同じ作業</li>
                            </ul>
                        </div>
                        <div class="pros">
                            <h5>✅ 市販のルー（Rails）</h5>
                            <ul>
                                <li>手順が確立されている</li>
                                <li>誰でもおいしく作れる</li>
                                <li>基本の味は保証済み</li>
                                <li>具材（アイデア）に集中</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <h3>Railsの基本構造</h3>
                <div class="code-box">
                    <pre>
myapp/
├── app/              ← メインのコード
│   ├── controllers/  ← リクエスト処理
│   ├── models/       ← データ・ビジネスロジック
│   ├── views/        ← 画面テンプレート
│   └── assets/       ← CSS、JavaScript、画像
├── config/           ← 設定ファイル
│   ├── routes.rb     ← URL設計
│   └── database.yml  ← DB設定
├── db/               ← データベース関連
│   └── migrate/      ← DB構造の変更履歴
├── public/           ← 静的ファイル
└── Gemfile           ← 使用ライブラリ一覧
                    </pre>
                </div>

                <h3>よく触るファイル TOP5</h3>
                <table>
                    <tr>
                        <th>ファイル/フォルダ</th>
                        <th>役割</th>
                        <th>使用頻度</th>
                        <th>重要度</th>
                    </tr>
                    <tr>
                        <td><code>app/controllers/</code></td>
                        <td>処理ロジック</td>
                        <td>⭐⭐⭐⭐⭐</td>
                        <td><span class="badge beginner-badge">必須</span></td>
                    </tr>
                    <tr>
                        <td><code>app/views/</code></td>
                        <td>画面デザイン</td>
                        <td>⭐⭐⭐⭐⭐</td>
                        <td><span class="badge beginner-badge">必須</span></td>
                    </tr>
                    <tr>
                        <td><code>config/routes.rb</code></td>
                        <td>URL設定</td>
                        <td>⭐⭐⭐⭐</td>
                        <td><span class="badge beginner-badge">必須</span></td>
                    </tr>
                    <tr>
                        <td><code>app/models/</code></td>
                        <td>データ構造</td>
                        <td>⭐⭐⭐</td>
                        <td><span class="badge">重要</span></td>
                    </tr>
                    <tr>
                        <td><code>db/migrate/</code></td>
                        <td>DB構造変更</td>
                        <td>⭐⭐⭐</td>
                        <td><span class="badge">重要</span></td>
                    </tr>
                </table>
            </div>

            <div class="section">
                <h2>💎 Gem・Bundler完全理解</h2>
                
                <div class="concept-box">
                    <h3>Gem（ジェム）とは？</h3>
                    <p><strong>Gem = Rubyのパッケージ管理システム</strong></p>
                    <ul>
                        <li>📦 <strong>ライブラリ</strong>をパッケージ化したもの</li>
                        <li>🌐 <strong>RubyGems.org</strong>から配布</li>
                        <li>⚡ <strong>機能拡張</strong>を簡単に追加</li>
                        <li>🔄 <strong>依存関係</strong>を自動解決</li>
                    </ul>
                </div>

                <div class="example-box">
                    <h4>🏪 Gemの比喩</h4>
                    <p><strong>アプリストアのようなもの</strong></p>
                    <div class="pros-cons">
                        <div class="pros">
                            <h5>✅ メリット</h5>
                            <ul>
                                <li>必要な機能をすぐに追加</li>
                                <li>車輪の再発明を避ける</li>
                                <li>コミュニティで検証済み</li>
                                <li>アップデートが簡単</li>
                            </ul>
                        </div>
                        <div class="cons">
                            <h5>⚠️ 注意点</h5>
                            <ul>
                                <li>依存関係が複雑になる場合</li>
                                <li>セキュリティリスク考慮必要</li>
                                <li>メンテナンス状況の確認必要</li>
                                <li>バージョン競合の可能性</li>
                            </ul>
                        </div>
                    </div>
                </div>

                <h3>Bundler（バンドラー）の役割</h3>
                <div class="concept-box">
                    <strong>Bundler = Gemの依存関係管理ツール</strong><br>
                    • プロジェクト毎にGemのバージョンを固定<br>
                    • チーム開発で環境を統一<br>
                    • 本番環境との整合性を保証
                </div>

                <h3>Gemfile & Gemfile.lock</h3>
                <div class="flow-chart">
                    <div><strong>Gemfile</strong></div>
                    <div style="font-size: 0.9rem;">使いたいGemを記述（人間が編集）</div>
                    <span class="flow-arrow">↓ bundle install</span>
                    
                    <div><strong>Gemfile.lock</strong></div>
                    <div style="font-size: 0.9rem;">実際にインストールされたバージョンを記録（自動生成）</div>
                    <span class="flow-arrow">↓</span>
                    
                    <div><strong>統一された環境</strong></div>
                    <div style="font-size: 0.9rem;">どこでも同じバージョンが使用される</div>
                </div>

                <h4>Gemfileの書き方</h4>
                <div class="code-box">
                    <pre>
# Gemfile
source "https://rubygems.org"

# Ruby バージョン指定
ruby "3.2.0"

# 必須のGem
gem "rails", "~> 7.1.0"        # バージョン範囲指定
gem "sqlite3", "~> 1.4"        # 開発・テスト用DB
gem "puma", ">= 5.0"           # Webサーバー

# アセット関連
gem "sassc-rails"              # Sass
gem "image_processing", "~> 1.2"  # 画像加工

# 開発環境でのみ使用
group :development do
  gem "web-console"            # デバッグコンソール
  gem "listen", "~> 3.3"       # ファイル変更監視
  gem "spring"                 # 高速化
end

# テスト環境でのみ使用
group :test do
  gem "capybara"               # 統合テスト
  gem "selenium-webdriver"     # ブラウザテスト
end

# 開発とテスト環境
group :development, :test do
  gem "debug", platforms: %i[ mri mingw x64_mingw ]  # デバッガー
  gem "rspec-rails"            # テストフレームワーク
  gem "factory_bot_rails"      # テストデータ生成
end

# 本番環境でのみ使用
group :production do
  gem "pg"                     # PostgreSQL
  gem "redis"                  # キャッシュ・セッション
end

# プラットフォーム指定
gem "bootsnap", ">= 1.4.4", require: false
gem "tzinfo-data", platforms: [:mingw, :mswin, :x64_mingw, :jruby]
                    </pre>
                </div>

                <h3>バージョン指定の方法</h3>
                <table>
                    <tr>
                        <th>指定方法</th>
                        <th>意味</th>
                        <th>例</th>
                        <th>マッチするバージョン</th>
                    </tr>
                    <tr>
                        <td><code>gem "rails"</code></td>
                        <td>最新版</td>
                        <td>-</td>
                        <td>常に最新</td>
                    </tr>
                    <tr>
                        <td><code>gem "rails", "7.1.0"</code></td>
                        <td>完全一致</td>
                        <td>7.1.0</td>
                        <td>7.1.0のみ</td>
                    </tr>
                    <tr>
                        <td><code>gem "rails", "~> 7.1.0"</code></td>
                        <td>マイナー固定</td>
                        <td>7.1.x</td>
                        <td>7.1.0〜7.1.x</td>
                    </tr>
                    <tr>
                        <td><code>gem "rails", ">= 7.0"</code></td>
                        <td>以上</td>
                        <td>7.0以上</td>
                        <td>7.0, 7.1, 8.0...</td>
                    </tr>
                    <tr>
                        <td><code>gem "rails", "< 8.0"</code></td>
                        <td>未満</td>
                        <td>8.0未満</td>
                        <td>7.x系まで</td>
                    </tr>
                </table>

                <h3>よく使うBundlerコマンド</h3>
                <table>
                    <tr>
                        <th>コマンド</th>
                        <th>動作</th>
                        <th>いつ使う？</th>
                    </tr>
                    <tr>
                        <td><code>bundle install</code></td>
                        <td>Gemをインストール</td>
                        <td>初回セットアップ・Gemfile変更後</td>
                    </tr>
                    <tr>
                        <td><code>bundle update</code></td>
                        <td>Gemを最新版に更新</td>
                        <td>定期的なアップデート</td>
                    </tr>
                    <tr>
                        <td><code>bundle exec</code></td>
                        <td>指定バージョンで実行</td>
                        <td>コマンド実行時</td>
                    </tr>
                    <tr>
                        <td><code>bundle add</code></td>
                        <td>新しいGemを追加</td>
                        <td>機能追加時</td>
                    </tr>
                    <tr>
                        <td><code>bundle remove</code></td>
                        <td>Gemを削除</td>
                        <td>不要なGem削除時</td>
                    </tr>
                </table>

                <h3>人気Gem紹介</h3>
                <div class="tag-selector">
                    <div class="tag active" onclick="showGemContent('essential')">必須系</div>
                    <div class="tag" onclick="showGemContent('database')">データベース</div>
                    <div class="tag" onclick="showGemContent('authentication')">認証・認可</div>
                    <div class="tag" onclick="showGemContent('testing')">テスト</div>
                    <div class="tag" onclick="showGemContent('ui')">UI・CSS</div>
                    <div class="tag" onclick="showGemContent('utility')">ユーティリティ</div>
                </div>

                <div id="essential" class="content-panel active">
                    <h4>必須系Gem</h4>
                    <table>
                        <tr>
                            <th>Gem名</th>
                            <th>用途</th>
                            <th>説明</th>
                        </tr>
                        <tr>
                            <td><strong>rails</strong></td>
                            <td>フレームワーク本体</td>
                            <td>Ruby on Rails のコア</td>
                        </tr>
                        <tr>
                            <td><strong>puma</strong></td>
                            <td>Webサーバー</td>
                            <td>高速なHTTPサーバー</td>
                        </tr>
                        <tr>
                            <td><strong>bootsnap</strong></td>
                            <td>起動高速化</td>
                            <td>Railsアプリの起動時間短縮</td>
                        </tr>
                        <tr>
                            <td><strong>sprockets-rails</strong></td>
                            <td>アセットパイプライン</td>
                            <td>CSS/JSファイルの管理</td>
                        </tr>
                    </table>
                </div>

                <div id="database" class="content-panel">
                    <h4>データベース系Gem</h4>
                    <table>
                        <tr>
                            <th>Gem名</th>
                            <th>用途</th>
                            <th>説明</th>
                        </tr>
                        <tr>
                            <td><strong>sqlite3</strong></td>
                            <td>SQLite</td>
                            <td>開発用軽量DB</td>
                        </tr>
                        <tr>
                            <td><strong>pg</strong></td>
                            <td>PostgreSQL</td>
                            <td>本番環境推奨DB</td>
                        </tr>
                        <tr>
                            <td><strong>mysql2</strong></td>
                            <td>MySQL</td>
                            <td>人気のRDB</td>
                        </tr>
                        <tr>
                            <td><strong>redis</strong></td>
                            <td>Redis</td>
                            <td>キャッシュ・セッション</td>
                        </tr>
                    </table>
                </div>

                <div id="authentication" class="content-panel">
                    <h4>認証・認可系Gem</h4>
                    <table>
                        <tr>
                            <th>Gem名</th>
                            <th>用途</th>
                            <th>説明</th>
                        </tr>
                        <tr>
                            <td><strong>devise</strong></td>
                            <td>認証システム</td>
                            <td>ユーザー登録・ログイン機能</td>
                        </tr>
                        <tr>
                            <td><strong>omniauth</strong></td>
                            <td>外部認証</td>
                            <td>Google、GitHub等でログイン</td>
                        </tr>
                        <tr>
                            <td><strong>cancancan</strong></td>
                            <td>認可システム</td>
                            <td>ユーザー権限管理</td>
                        </tr>
                        <tr>
                            <td><strong>pundit</strong></td>
                            <td>認可システム</td>
                            <td>ポリシーベースの権限管理</td>
                        </tr>
                    </table>
                </div>

                <div id="testing" class="content-panel">
                    <h4>テスト系Gem</h4>
                    <table>
                        <tr>
                            <th>Gem名</th>
                            <th>用途</th>
                            <th>説明</th>
                        </tr>
                        <tr>
                            <td><strong>rspec-rails</strong></td>
                            <td>テストフレームワーク</td>
                            <td>BDD形式のテスト</td>
                        </tr>
                        <tr>
                            <td><strong>factory_bot_rails</strong></td>
                            <td>テストデータ</td>
                            <td>テスト用オブジェクト生成</td>
                        </tr>
                        <tr>
                            <td><strong>capybara</strong></td>
                            <td>統合テスト</td>
                            <td>ブラウザ操作のテスト</td>
                        </tr>
                        <tr>
                            <td><strong>selenium-webdriver</strong></td>
                            <td>ブラウザ自動化</td>
                            <td>実ブラウザでのテスト</td>
                        </tr>
                    </table>
                </div>

                <div id="ui" class="content-panel">
                    <h4>UI・CSS系Gem</h4>
                    <table>
                        <tr>
                            <th>Gem名</th>
                            <th>用途</th>
                            <th>説明</th>
                        </tr>
                        <tr>
                            <td><strong>bootstrap</strong></td>
                            <td>CSSフレームワーク</td>
                            <td>レスポンシブデザイン</td>
                        </tr>
                        <tr>
                            <td><strong>sassc-rails</strong></td>
                            <td>Sass</td>
                            <td>CSS拡張言語</td>
                        </tr>
                        <tr>
                            <td><strong>image_processing</strong></td>
                            <td>画像処理</td>
                            <td>リサイズ・圧縮等</td>
                        </tr>
                        <tr>
                            <td><strong>kaminari</strong></td>
                            <td>ページネーション</td>
                            <td>ページ分割機能</td>
                        </tr>
                    </table>
                </div>

                <div id="utility" class="content-panel">
                    <h4>ユーティリティ系Gem</h4>
                    <table>
                        <tr>
                            <th>Gem名</th>
                            <th>用途</th>
                            <th>説明</th>
                        </tr>
                        <tr>
                            <td><strong>dotenv-rails</strong></td>
                            <td>環境変数管理</td>
                            <td>.env ファイルから読み込み</td>
                        </tr>
                        <tr>
                            <td><strong>sidekiq</strong></td>
                            <td>バックグラウンドジョブ</td>
                            <td>非同期処理</td>
                        </tr>
                        <tr>
                            <td><strong>whenever</strong></td>
                            <td>cron管理</td>
                            <td>定期実行タスク</td>
                        </tr>
                        <tr>
                            <td><strong>ransack</strong></td>
                            <td>検索機能</td>
                            <td>高度な検索・ソート</td>
                        </tr>
                    </table>
                </div>

                <div class="important">
                    <h4>⚠️ Gem使用時の注意点</h4>
                    <ul>
                        <li><strong>セキュリティ</strong>：定期的にアップデートする</li>
                        <li><strong>メンテナンス</strong>：活発に開発されているかチェック</li>
                        <li><strong>依存関係</strong>：競合しないか確認</li>
                        <li><strong>ライセンス</strong>：商用利用可能か確認</li>
                        <li><strong>サイズ</strong>：アプリの起動時間への影響考慮</li>
                    </ul>
                </div>
            </div>

            <div class="section">
                <h2>🛠️ Railsコマンド完全ガイド</h2>
                
                <h3>なぜコマンドを使うの？</h3>
                <div class="concept-box">
                    <strong>Railsの哲学：「繰り返し作業は自動化」</strong><br>
                    • 手動作成 → ミスが起きやすい<br>
                    • コマンド生成 → 正しい場所に正しい形式で<br>
                    • 規約に沿った命名を自動適用
                </div>

                <h3>基本コマンド</h3>
                <table>
                    <tr>
                        <th>コマンド</th>
                        <th>用途</th>
                        <th>使用例</th>
                    </tr>
                    <tr>
                        <td><code>rails new</code></td>
                        <td>アプリ作成</td>
                        <td><code>rails new blog</code></td>
                    </tr>
                    <tr>
                        <td><code>rails server</code></td>
                        <td>サーバー起動</td>
                        <td><code>rails s</code></td>
                    </tr>
                    <tr>
                        <td><code>rails console</code></td>
                        <td>対話環境</td>
                        <td><code>rails c</code></td>
                    </tr>
                    <tr>
                        <td><code>rails generate</code></td>
                        <td>ファイル生成</td>
                        <td><code>rails g model User</code></td>
                    </tr>
                </table>

                <h3>生成コマンド詳細</h3>
                <div class="code-box">
                    <pre>
# モデル生成（データ構造）
rails g model Post title:string content:text published:boolean
# 生成されるもの：
# - app/models/post.rb
# - db/migrate/xxx_create_posts.rb
# - test/models/post_test.rb

# コントローラー生成（処理ロジック）
rails g controller Posts index show new create edit update destroy
# 生成されるもの：
# - app/controllers/posts_controller.rb
# - app/views/posts/index.html.erb (各アクション分)
# - app/helpers/posts_helper.rb
# - test/controllers/posts_controller_test.rb

# スキャフォールド（全部まとめて）
rails g scaffold Article title:string content:text
# 生成されるもの：
# - 上記のモデル + コントローラー
# - 完全なCRUD機能
# - routes.rbへの追記

# マイグレーション（DB構造変更）
rails g migration AddAgeToUsers age:integer
rails g migration RemoveEmailFromUsers email:string
rails g migration CreateJoinTableUserPost user post
                    </pre>
                </div>

                <h3>データベースコマンド</h3>
                <table>
                    <tr>
                        <th>コマンド</th>
                        <th>動作</th>
                        <th>いつ使う？</th>
                    </tr>
                    <tr>
                        <td><code>rails db:create</code></td>
                        <td>DB作成</td>
                        <td>プロジェクト開始時</td>
                    </tr>
                    <tr>
                        <td><code>rails db:migrate</code></td>
                        <td>マイグレーション実行</td>
                        <td>DB構造変更後</td>
                    </tr>
                    <tr>
                        <td><code>rails db:rollback</code></td>
                        <td>マイグレーション取り消し</td>
                        <td>やり直したい時</td>
                    </tr>
                    <tr>
                        <td><code>rails db:seed</code></td>
                        <td>初期データ投入</td>
                        <td>サンプルデータが欲しい時</td>
                    </tr>
                    <tr>
                        <td><code>rails db:reset</code></td>
                        <td>DB完全リセット</td>
                        <td>最初からやり直したい時</td>
                    </tr>
                </table>
            </div>
            
            <div style="text-align: center; margin-top: 30px;">
                <button onclick="showMainContent('mvc-deep')" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 12px 24px; border-radius: 25px; font-size: 16px; cursor: pointer; transition: all 0.3s ease;">
                    次へ →
                </button>
            </div>
        </div>

        <!-- MVC詳解 -->
        <div id="mvc-deep" class="content-section">
            <div class="section" id="mvc-pattern">
                <h2>🍳 MVCパターン完全理解</h2>
                
                <div class="concept-box">
                    <h3>🍛 フレームワークはカレールーのようなもの</h3>
                    <p>スパイスから一からカレーを作ることもできますが、配合は難しく、失敗のリスクもあります。一方でルーを使えば、<strong>決まった工程で決まった味が約束</strong>され、具材選びに注力できます。</p>
                    <p>フレームワークも同じで、決まった構成を使うことで記述の統一化、チェックの容易化、品質担保が実現されます。その代表的な構成がMVCです。</p>
                </div>
                
                <div class="example-box">
                    <h3>🏪 MVCをレストランで理解しよう</h3>
                    <p>MVCは一つのレストランとして捉えると分かりやすくなります。<br>
                    <strong>お客様が来た際に、その案内をし注文を受けるのはホールスタッフ。実際に料理というビジネスロジックを担うのはシェフ。そして、シェフの作成した料理をさらに盛り付けて整えるのがアシスタント。</strong></p>
                </div>

                <h3>📊 最小構成から理解する</h3>
                <div class="flow-chart">
                    <h4>Step 1: 最小のMVC構成</h4>
                    <div class="flow-item">👤 お客様（ユーザー）</div>
                    <div>「ブログ記事一覧見せて！」</div>
                    <span class="flow-arrow">↓ リクエスト</span>
                    
                    <div class="flow-item">🤵 Controller<br>（ホールスタッフ）</div>
                    <div>リクエストを受け取り、適切な処理に振り分け</div>
                    <span class="flow-arrow">↓</span>
                    
                    <div class="flow-item">👨‍🍳 Model<br>（シェフ）</div>
                    <div>データベースから情報を取得・加工</div>
                    <span class="flow-arrow">↓</span>
                    
                    <div class="flow-item">🍽️ View<br>（盛り付けアシスタント）</div>
                    <div>データを美しくHTML形式で整形</div>
                    <span class="flow-arrow">↓</span>
                    
                    <div class="flow-item">😊 お客様（ユーザー）</div>
                    <div>美しく整形されたページを受け取る</div>
                </div>
                
                <div class="important">
                    <strong>💡 なぜこの分離が重要？</strong><br>
                    レストランでもホールスタッフが料理を作ったり、シェフが接客したりしないように、各層の責任を明確に分離することで、コードの管理が容易になり、チームでの開発も効率的になります。
                </div>

                <h3>🏥 実際のWebアプリケーションでは...</h3>
                
                <div class="concept-box">
                    <strong>MVCだけでは不十分な現実</strong><br>
                    レストランの例でMVCを理解しましたが、実際のWebアプリケーションを考えてみましょう。<br>
                    お客様の要望は料理を頼むだけにとどまりません：
                    <ul style="text-align: left; margin: 10px 20px;">
                        <li>「料理の説明が欲しい」 → メニュー担当へ</li>
                        <li>「水を持ってきてほしい」 → ドリンク担当へ</li>
                        <li>「子ども用の椅子が欲しい」 → 設備担当へ</li>
                        <li>「予約をしたい」 → 予約管理担当へ</li>
                    </ul>
                    ホールスタッフはその内容に応じて、適切な処理担当にバイパスする必要があります。
                </div>

                <div class="important">
                    <strong>🎯 フレームワークによるアプローチの違い</strong><br>
                    <div style="margin: 15px 0;">
                        <strong>統合型（Java, C#など静的型付け言語）:</strong><br>
                        • コントローラー（ホールスタッフ）が<strong>調整も処理も両方</strong>担当<br>
                        • @GetMapping("/users/{id}")のようにコントローラーに直接ルート情報を記述<br>
                        • 利点：型安全性が高く、IDEサポートが充実<br><br>
                        
                        <strong>分離型（Ruby, PHP, Pythonなど動的型付け言語）:</strong><br>
                        • 調整部分は<strong>Routes</strong>という別クラスが担当<br>
                        • コントローラーは純粋に処理のみに専念<br>
                        • 利点：柔軟性が高く、ルーティングを一覧で管理可能<br><br>
                        
                        <strong>ハイブリッド型（Go, Rust）:</strong><br>
                        • 統合するか分離するかを<strong>柔軟に選択可能</strong><br>
                        • プロジェクトの規模や要件に応じて最適な方法を選べる
                    </div>
                </div>
                
                <h3>🚪 Routesの登場</h3>
                
                <div class="flow-chart">
                    <h4>Step 2: 複数機能への対応</h4>
                    <div class="example-box">
                        <strong>問題：どの部署に案内すべき？</strong><br>
                        <div style="background: #fee2e2; padding: 15px; margin: 10px 0; border-radius: 8px;">
                            ユーザー「/posts/1にアクセスしたい」<br>
                            ↓<br>
                            システム「PostsController？UsersController？CommentsController？どれ？」
                        </div>
                    </div>
                    
                    <div class="tip">
                        <strong>解決策：Routes（ルーティング）</strong><br>
                        リクエストのURL（/posts/1）を見て、適切なController（PostsController）に案内する<strong>案内係</strong>が必要です。<br>
                        これが<strong>Routes</strong>の役割です。
                    </div>
                </div>
                
                <div class="section" style="background: #f8fafc;">
                    <h4>📝 主要フレームワークの実装例</h4>
                    
                    <div class="tag-selector">
                        <span class="tag active" onclick="showFrameworkContent('separated-panel')">分離型</span>
                        <span class="tag" onclick="showFrameworkContent('integrated-panel')">統合型</span>
                        <span class="tag" onclick="showFrameworkContent('hybrid-panel')">ハイブリッド型</span>
                    </div>
                    
                    <div id="separated-panel" class="content-panel active">
                        <h5>分離型（ルーティングとコントローラーが別）</h5>
                        
                        <div class="code-box">
                            <pre>
<strong>Ruby - Rails</strong>
# config/routes.rb
get '/users/:id', to: 'users#show'

# app/controllers/users_controller.rb
class UsersController < ApplicationController
  def show
    @user = User.find(params[:id])
  end
end
                            </pre>
                        </div>
                        
                        <div class="code-box">
                            <pre>
<strong>PHP - Laravel</strong>
// routes/web.php
Route::get('/users/{id}', [UserController::class, 'show']);

// app/Http/Controllers/UserController.php
public function show($id) {
    return User::find($id);
}
                            </pre>
                        </div>
                        
                        <div class="code-box">
                            <pre>
<strong>Python - Django</strong>
# urls.py
path('users/<int:id>/', views.user_detail)

# views.py
def user_detail(request, id):
    user = User.objects.get(pk=id)
                            </pre>
                        </div>
                        
                        <div class="code-box">
                            <pre>
<strong>JavaScript - Express.js（動的型言語）</strong>
// routes/users.js
router.get('/:id', userController.show)

// controllers/userController.js
exports.show = (req, res) => {
    const user = User.find(req.params.id)
}
                            </pre>
                        </div>
                        
                        <div class="tip">
                            <strong>💡 ポイント</strong><br>
                            動的型付け言語のフレームワークは、柔軟性を重視してルーティングを分離する傾向があります。
                            設定ファイルで一括管理できるため、ルートの全体像を把握しやすくなります。
                        </div>
                    </div>
                    
                    <div id="integrated-panel" class="content-panel">
                        <h5>統合型（コントローラーにルーティング情報を含む）</h5>
                        
                        <div class="code-box">
                            <pre>
<strong>Java - Spring</strong>
@RestController
public class UserController {
    @GetMapping("/users/{id}")
    public User show(@PathVariable Long id) {
        return userService.find(id);
    }
}
                            </pre>
                        </div>
                        
                        <div class="code-box">
                            <pre>
<strong>C# - ASP.NET Core</strong>
[ApiController]
[Route("api/[controller]")]
public class UsersController : ControllerBase {
    [HttpGet("{id}")]
    public User Get(int id) {
        return userService.Find(id);
    }
}
                            </pre>
                        </div>
                        
                        <div class="code-box">
                            <pre>
<strong>Python - FastAPI</strong>
@app.get("/users/{user_id}")
async def read_user(user_id: int):
    return {"user_id": user_id}
                            </pre>
                        </div>
                        
                        <div class="code-box">
                            <pre>
<strong>TypeScript - NestJS（JavaScriptの静的型版）</strong>
@Controller('users')
export class UsersController {
    @Get(':id')
    findOne(@Param('id') id: string) {
        return this.usersService.findOne(id);
    }
}
                            </pre>
                        </div>
                        
                        <div class="important">
                            <strong>🎯 JavaScript vs TypeScript の違い</strong><br>
                            同じJavaScriptベースでも：<br>
                            • <strong>JavaScript (Express.js)</strong>: 動的型のため分離型を採用<br>
                            • <strong>TypeScript (NestJS)</strong>: 静的型のためデコレーター統合型を採用<br>
                            これは型システムがフレームワーク設計に大きく影響することを示しています。
                        </div>
                        
                        <div class="tip">
                            <strong>💡 ポイント</strong><br>
                            静的型付け言語のフレームワークは、型安全性とIDEサポートを活かすため、
                            アノテーション/デコレーターでルートを定義する統合型を採用する傾向があります。
                        </div>
                    </div>
                    
                    <div id="hybrid-panel" class="content-panel">
                        <h5>ハイブリッド型（両方サポート）</h5>
                        
                        <div class="code-box">
                            <pre>
<strong>Go - Gin/Echo</strong>
// 分離スタイル
router.GET("/users/:id", userController.Show)

// 統合スタイル（構造体メソッド）
type UserController struct{}
func (c *UserController) Show(ctx *gin.Context) {
    id := ctx.Param("id")
}
                            </pre>
                        </div>
                        
                        <div class="code-box">
                            <pre>
<strong>Rust - Actix-web/Rocket</strong>
// Actix-web（分離型）
App::new()
    .route("/users/{id}", web::get().to(get_user))

// Rocket（統合型）
#[get("/users/<id>")]
fn get_user(id: i32) -> Json<User> {
    Json(user)
}
                            </pre>
                        </div>
                        
                        <div class="tip">
                            <strong>💡 ポイント</strong><br>
                            Go や Rust のような現代的な言語は、プロジェクトの要件に応じて
                            分離型・統合型を柔軟に選択できる設計になっています。
                            小規模なら統合型、大規模なら分離型といった使い分けが可能です。
                        </div>
                    </div>
                </div>

                <script>
                function showFrameworkContent(panelId) {
                    // タグのアクティブ状態を更新
                    const tags = document.querySelectorAll('.section .tag-selector .tag');
                    tags.forEach(tag => {
                        tag.classList.remove('active');
                    });
                    event.target.classList.add('active');
                    
                    // コンテンツの表示切り替え
                    const panels = document.querySelectorAll('.section .content-panel');
                    panels.forEach(panel => {
                        panel.classList.remove('active');
                    });
                    const targetPanel = document.getElementById(panelId);
                    if (targetPanel) {
                        targetPanel.classList.add('active');
                    }
                }
                </script>

                <div class="concept-box">
                    <h4>🏗️ フロントコントローラーパターンの実装</h4>
                    <p>すべてのWebフレームワークは「フロントコントローラーパターン」を採用しています：</p>
                    
                    <table style="margin: 15px 0;">
                        <tr>
                            <th>フレームワーク</th>
                            <th>フロントコントローラー</th>
                            <th>ルーティング定義</th>
                        </tr>
                        <tr>
                            <td><strong>Rails</strong></td>
                            <td>Rack + ActionDispatch</td>
                            <td>config/routes.rb</td>
                        </tr>
                        <tr>
                            <td><strong>Laravel</strong></td>
                            <td>public/index.php</td>
                            <td>routes/*.php</td>
                        </tr>
                        <tr>
                            <td><strong>Spring (Java)</strong></td>
                            <td>DispatcherServlet</td>
                            <td>@RequestMapping等のアノテーション</td>
                        </tr>
                    </table>
                    
                    <div class="tip">
                        どのフレームワークも「すべてのリクエストを受け付ける窓口」と「振り分けルール」は分離していますが、
                        ルールの<strong>記述場所</strong>が異なるだけです。
                    </div>
                </div>

                <div class="flow-chart">
                    <h4>Step 3: Routesを含む完全な流れ（Rails版）</h4>
                    <div class="flow-item">👤 ユーザー</div>
                    <div>「/posts/1 にアクセス」</div>
                    <span class="flow-arrow">↓ HTTPリクエスト</span>
                    
                    <div class="flow-item" style="background: linear-gradient(135deg, #f59e0b 0%, #ef4444 100%);">🚪 Routes<br>（案内係）</div>
                    <div>「/posts/1 なら PostsController の show アクションですね」</div>
                    <span class="flow-arrow">↓ 適切な部署に案内</span>
                    
                    <div class="flow-item">🤵 PostsController</div>
                    <span class="flow-arrow">↓</span>
                    <div class="flow-item">👨‍🍳 Model</div>
                    <span class="flow-arrow">↓</span>
                    <div class="flow-item">🍽️ View</div>
                    <span class="flow-arrow">↓ レスポンス</span>
                    <div class="flow-item">😊 ユーザー</div>
                </div>
                
                <h3>🤔 1つの機能しかない場合は？</h3>
                
                <div class="important">
                    <strong>理論的には不要、でも実際は必須</strong><br>
                    もしアプリケーションに本当に1つの機能しかないなら、案内係は不要に思えますよね？<br>
                    <strong>でも、Railsなどのフレームワークでは、仕組み上必ずRoutesを通るように作られています。</strong><br>
                    つまり、機能が1つでもroutes.rbファイルにルート定義を書く必要があるのです。
                </div>
                
                <div class="code-box">
                    <pre>
# config/routes.rb - 必須のルート定義

Rails.application.routes.draw do
  # 機能が1つでも必ず定義が必要
  get '/posts', to: 'posts#index'    
  
  # 複数機能になると本格的に活躍
  get '/posts/:id', to: 'posts#show'   # ブログ記事詳細
  get '/users/new', to: 'users#new'    # ユーザー登録
  post '/comments', to: 'comments#create' # コメント投稿
  get '/profiles/edit', to: 'profiles#edit' # プロフィール編集
  
  # 一括設定でシンプルに
  resources :posts  # 7つの基本操作を一度に定義
end</pre>
                </div>
                
                <h3>各層の詳細な役割</h3>
                <table>
                    <tr>
                        <th>MVC</th>
                        <th>レストラン例</th>
                        <th>実際の役割</th>
                        <th>Railsでの場所</th>
                    </tr>
                    <tr>
                        <td><strong>Routes</strong></td>
                        <td>受付係</td>
                        <td>
                            • URLと担当者のマッピング<br>
                            • 「どのホールスタッフが対応するか」<br>
                            • HTTPメソッドの判別
                        </td>
                        <td><code>config/routes.rb</code></td>
                    </tr>
                    <tr>
                        <td><strong>Controller</strong></td>
                        <td>ホールスタッフ</td>
                        <td>
                            • リクエストの受付<br>
                            • 処理の振り分け<br>
                            • ModelとViewの調整<br>
                            • レスポンスの決定
                        </td>
                        <td><code>app/controllers/</code></td>
                    </tr>
                    <tr>
                        <td><strong>Model</strong></td>
                        <td>シェフ</td>
                        <td>
                            • データの管理<br>
                            • ビジネスロジック<br>
                            • DB操作<br>
                            • バリデーション
                        </td>
                        <td><code>app/models/</code></td>
                    </tr>
                    <tr>
                        <td><strong>View</strong></td>
                        <td>盛り付けアシスタント</td>
                        <td>
                            • 画面の表示<br>
                            • HTMLの生成<br>
                            • ユーザーインターフェース<br>
                            • レスポンスの整形
                        </td>
                        <td><code>app/views/</code></td>
                    </tr>
                </table>

                <h3>アクション（Action）とは？</h3>
                <div class="concept-box">
                    <strong>アクション = コントローラー内で定義されたpublicメソッド</strong><br>
                    1つのアクションが1つのWebページや処理に対応します
                </div>

                <div class="code-box">
                    <pre>
class PostsController < ApplicationController
  # これがアクション ↓
  def index
    @posts = Post.all
  end
  
  # これもアクション ↓
  def show
    @post = Post.find(params[:id])
  end
  
  # privateメソッドはアクションではない
  private
  
  def post_params
    params.require(:post).permit(:title, :content)
  end
end
                    </pre>
                </div>

                <h3>7つの標準アクション（RESTful）</h3>
                <table>
                    <tr>
                        <th>アクション</th>
                        <th>HTTP</th>
                        <th>URL</th>
                        <th>役割</th>
                        <th>画面例</th>
                    </tr>
                    <tr>
                        <td><strong>index</strong></td>
                        <td>GET</td>
                        <td>/posts</td>
                        <td>一覧表示</td>
                        <td>ブログ記事一覧</td>
                    </tr>
                    <tr>
                        <td><strong>show</strong></td>
                        <td>GET</td>
                        <td>/posts/:id</td>
                        <td>詳細表示</td>
                        <td>記事の本文</td>
                    </tr>
                    <tr>
                        <td><strong>new</strong></td>
                        <td>GET</td>
                        <td>/posts/new</td>
                        <td>作成フォーム</td>
                        <td>新規投稿画面</td>
                    </tr>
                    <tr>
                        <td><strong>create</strong></td>
                        <td>POST</td>
                        <td>/posts</td>
                        <td>作成処理</td>
                        <td>（リダイレクト）</td>
                    </tr>
                    <tr>
                        <td><strong>edit</strong></td>
                        <td>GET</td>
                        <td>/posts/:id/edit</td>
                        <td>編集フォーム</td>
                        <td>編集画面</td>
                    </tr>
                    <tr>
                        <td><strong>update</strong></td>
                        <td>PATCH/PUT</td>
                        <td>/posts/:id</td>
                        <td>更新処理</td>
                        <td>（リダイレクト）</td>
                    </tr>
                    <tr>
                        <td><strong>destroy</strong></td>
                        <td>DELETE</td>
                        <td>/posts/:id</td>
                        <td>削除処理</td>
                        <td>（リダイレクト）</td>
                    </tr>
                </table>

                <div class="important">
                    <strong>覚えておこう：</strong><br>
                    この7つのアクションで、ほとんどのWebアプリの機能が作れる！
                </div>
            </div>

            <div class="section">
                <h2>🔄 Render vs Redirect 完全マスター</h2>
                
                <div class="flow-chart">
                    <h3>処理の流れの違い</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
                        <div>
                            <h4>🔄 Redirect の場合</h4>
                            <div class="flow-item">Controller処理</div>
                            <span class="flow-arrow">↓</span>
                            <div class="flow-item">ブラウザに「移動して」</div>
                            <span class="flow-arrow">↓</span>
                            <div class="flow-item">新URLにアクセス</div>
                            <span class="flow-arrow">↓</span>
                            <div class="flow-item">新ページ表示</div>
                        </div>
                        <div>
                            <h4>📄 Render の場合</h4>
                            <div class="flow-item">Controller処理</div>
                            <span class="flow-arrow">↓</span>
                            <div class="flow-item">指定ビューを直接表示</div>
                            <span class="flow-arrow">↓</span>
                            <div class="flow-item">ページ表示</div>
                            <span class="flow-arrow">↓</span>
                            <div style="opacity: 0.5;">URLは変わらない</div>
                        </div>
                    </div>
                </div>

                <h3>使い分けのルール</h3>
                <table>
                    <tr>
                        <th>状況</th>
                        <th>使用方法</th>
                        <th>理由</th>
                        <th>例</th>
                    </tr>
                    <tr>
                        <td>データ保存成功</td>
                        <td><code>redirect_to</code></td>
                        <td>PRGパターン</td>
                        <td>投稿作成 → 詳細ページ</td>
                    </tr>
                    <tr>
                        <td>バリデーションエラー</td>
                        <td><code>render</code></td>
                        <td>エラー情報保持</td>
                        <td>入力エラー → 入力画面再表示</td>
                    </tr>
                    <tr>
                        <td>削除成功</td>
                        <td><code>redirect_to</code></td>
                        <td>削除後のページへ</td>
                        <td>記事削除 → 一覧ページ</td>
                    </tr>
                    <tr>
                        <td>権限エラー</td>
                        <td><code>render</code></td>
                        <td>エラーページ直接表示</td>
                        <td>403エラーページ</td>
                    </tr>
                </table>

                <div class="code-box">
                    <pre>
class PostsController < ApplicationController
  def create
    @post = Post.new(post_params)
    
    if @post.save
      # 成功時はリダイレクト → PRGパターン
      redirect_to @post, notice: '投稿を作成しました'
    else
      # 失敗時はレンダー → バリデーションエラーを表示
      render :new, status: :unprocessable_entity
    end
  end
  
  def update
    @post = Post.find(params[:id])
    
    if @post.update(post_params)
      redirect_to @post, notice: '投稿を更新しました'
    else
      # edit アクションではなく :edit ビューをレンダー
      render :edit, status: :unprocessable_entity
    end
  end
  
  def destroy
    @post = Post.find(params[:id])
    @post.destroy!
    
    # 削除後は一覧ページにリダイレクト
    redirect_to posts_path, 
                notice: '投稿を削除しました',
                status: :see_other
  end
end
                    </pre>
                </div>

                <div class="important">
                    <strong>PRG（Post-Redirect-Get）パターン：</strong><br>
                    データ更新後はリダイレクトすることで、ブラウザの「戻る」「再読み込み」による重複送信を防ぐ重要な設計パターン
                </div>
            </div>

            <div class="section">
                <h2>💬 Flash メッセージシステム</h2>
                
                <h3>Flashの種類と使い分け</h3>
                <table>
                    <tr>
                        <th>種類</th>
                        <th>用途</th>
                        <th>表示タイミング</th>
                        <th>例</th>
                    </tr>
                    <tr>
                        <td><code>flash[:notice]</code></td>
                        <td>成功メッセージ</td>
                        <td>次のリクエスト</td>
                        <td>「保存しました」</td>
                    </tr>
                    <tr>
                        <td><code>flash[:alert]</code></td>
                        <td>エラーメッセージ</td>
                        <td>次のリクエスト</td>
                        <td>「削除できませんでした」</td>
                    </tr>
                    <tr>
                        <td><code>flash.now[:notice]</code></td>
                        <td>即座に表示</td>
                        <td>現在のリクエスト</td>
                        <td>「検索結果なし」</td>
                    </tr>
                </table>

                <div class="code-box">
                    <pre>
class PostsController < ApplicationController
  def create
    @post = Post.new(post_params)
    
    if @post.save
      # redirect で次のページへ → flash を使用
      redirect_to @post, notice: '投稿を作成しました'
      # 上記は下記と同じ意味
      # flash[:notice] = '投稿を作成しました'
      # redirect_to @post
    else
      # render で同じページを再表示 → flash.now を使用
      flash.now[:alert] = '作成に失敗しました'
      render :new, status: :unprocessable_entity
    end
  end
  
  def search
    @posts = Post.where("title LIKE ?", "%#{params[:q]}%")
    
    if @posts.empty?
      flash.now[:notice] = "「#{params[:q]}」の検索結果が見つかりませんでした"
    end
    
    render :index
  end
end
                    </pre>
                </div>

                <h3>ビューでのFlash表示</h3>
                <div class="code-box">
                    <pre>
&lt;!-- app/views/layouts/application.html.erb --&gt;
&lt;% flash.each do |type, message| %&gt;
  &lt;div class="alert alert-&lt;%= type == 'notice' ? 'success' : 'danger' %&gt;"&gt;
    &lt;%= message %&gt;
  &lt;/div&gt;
&lt;% end %&gt;

&lt;!-- より詳細な制御 --&gt;
&lt;% if flash[:notice] %&gt;
  &lt;div class="alert alert-success alert-dismissible"&gt;
    &lt;button type="button" class="close" data-dismiss="alert"&gt;&amp;times;&lt;/button&gt;
    &lt;%= flash[:notice] %&gt;
  &lt;/div&gt;
&lt;% end %&gt;

&lt;% if flash[:alert] %&gt;
  &lt;div class="alert alert-danger alert-dismissible"&gt;
    &lt;button type="button" class="close" data-dismiss="alert"&gt;&amp;times;&lt;/button&gt;
    &lt;%= flash[:alert] %&gt;
  &lt;/div&gt;
&lt;% end %&gt;
                    </pre>
                </div>
            </div>
            
            <div style="text-align: center; margin-top: 30px;">
                <button onclick="showMainContent('advanced')" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 12px 24px; border-radius: 25px; font-size: 16px; cursor: pointer; transition: all 0.3s ease;">
                    次へ →
                </button>
            </div>
        </div>

        <!-- 実践テクニック -->
        <div id="advanced" class="content-section">
            <div class="section">
                <h2>🎯 実践テクニック</h2>
                
                <div class="tag-selector">
                    <span class="tag active" onclick="showAdvancedContent('dev-workflow')">開発進行</span>
                    <span class="tag" onclick="showAdvancedContent('security')">セキュリティ</span>
                    <span class="tag" onclick="showAdvancedContent('usability')">ユーザビリティ</span>
                </div>
                
                <!-- 開発進行 -->
                <div id="dev-workflow" class="content-panel active">
                    <h3>スキャフォールドの真実 <span class="badge beginner-badge">初心者必読</span></h3>
                <div class="pros-cons">
                    <div class="pros">
                        <h4>✅ メリット</h4>
                        <ul>
                            <li>学習用として最適</li>
                            <li>プロトタイプ高速作成</li>
                            <li>Railsの規約を学べる</li>
                            <li>基本CRUD操作が完成</li>
                        </ul>
                    </div>
                    <div class="cons">
                        <h4>❌ デメリット</h4>
                        <ul>
                            <li>不要なコードも生成</li>
                            <li>カスタマイズが必要</li>
                            <li>実プロジェクトには不向き</li>
                            <li>デザインが汎用的</li>
                        </ul>
                    </div>
                </div>

                <div class="warning">
                    <h4>上級者がスキャフォールドを使わない理由</h4>
                    <ul>
                        <li>🎯 <strong>要件特化</strong>：実際のプロジェクトは独自要件が多い</li>
                        <li>🔒 <strong>セキュリティ</strong>：より厳しいセキュリティ要件</li>
                        <li>⚡ <strong>パフォーマンス</strong>：最適化が必要</li>
                        <li>👥 <strong>チーム規約</strong>：独自のコーディング規約</li>
                    </ul>
                </div>

                <h3>N+1クエリ問題の解決 <span class="badge advanced-badge">上級</span></h3>
                <div class="warning">
                    <h4>❌ 問題のあるコード</h4>
                    <div class="code-box">
                        <pre>
# 悪い例：N+1クエリが発生
@posts = Post.all  # 1回のクエリ
@posts.each do |post|
  puts post.user.name     # 各postに対してUserクエリ（N回）
  puts post.comments.count # 各postに対してCommentクエリ（N回）
end
# 合計：1 + N + N = 2N + 1 回のクエリ
                        </pre>
                    </div>
                </div>

                <div class="tip">
                    <h4>✅ 改善されたコード</h4>
                    <div class="code-box">
                        <pre>
# 良い例：includesで一括取得
@posts = Post.includes(:user, :comments)  # 3回のクエリで完了
@posts.each do |post|
  puts post.user.name     # 追加クエリなし
  puts post.comments.count # 追加クエリなし
end

# より複雑な関連も一括取得可能
@posts = Post.includes(:user, :comments, tags: :category)

# 条件付きinclude
@posts = Post.includes(:user).where(users: { active: true })

# joins を使った効率的な絞り込み
@posts = Post.joins(:user).where(users: { premium: true })
                        </pre>
                    </div>
                </div>

                <h3>ストロングパラメータ詳解 <span class="badge">セキュリティ</span></h3>
                <div class="concept-box">
                    <strong>ストロングパラメータ = 悪意のあるデータから守る「門番」</strong>
                </div>

                <div class="flow-chart">
                    <div><strong>ユーザーからのデータ</strong></div>
                    <div style="background: #fee2e2; padding: 15px; border-radius: 10px; margin: 10px 0;">
                        name: "太郎"<br>
                        email: "taro@example.com"<br>
                        <span style="color: red; font-weight: bold;">admin: true  ← 悪意のあるデータ！</span>
                    </div>
                    <span class="flow-arrow">↓</span>
                    
                    <div><strong>ストロングパラメータで検査</strong></div>
                    <div class="code-box">
                        <pre>
def user_params
  params.require(:user).permit(:name, :email)
  # adminは許可していないので除外される！
end
                        </pre>
                    </div>
                    <span class="flow-arrow">↓</span>
                    
                    <div><strong>安全なデータのみ通過</strong></div>
                    <div style="background: #d1fae5; padding: 15px; border-radius: 10px; margin: 10px 0;">
                        name: "太郎"<br>
                        email: "taro@example.com"
                    </div>
                </div>

                <div class="code-box">
                    <pre>
class UsersController < ApplicationController
  def create
    @user = User.new(user_params)
    
    if @user.save
      redirect_to @user, notice: 'ユーザーを作成しました'
    else
      render :new, status: :unprocessable_entity
    end
  end
  
  private
  
  # 基本的なパラメータ
  def user_params
    params.require(:user).permit(:name, :email, :age)
  end
  
  # 配列を含むパラメータ
  def post_params
    params.require(:post).permit(:title, :content, tag_ids: [])
  end
  
  # ネストした属性
  def user_params
    params.require(:user).permit(:name, :email, 
                                  profile_attributes: [:bio, :website])
  end
  
  # 条件付きパラメータ
  def user_params
    permitted = [:name, :email]
    permitted << :admin if current_user.admin?
    params.require(:user).permit(permitted)
  end
end
                    </pre>
                </div>

                    <h3>既存DBテーブルへの対応 <span class="badge advanced-badge">上級</span></h3>
                    <div class="concept-box">
                        <strong>既存のデータベースにRailsを導入する場合の戦略</strong>
                    </div>
                    
                    <div class="code-box">
                        <pre>
# 1. 既存テーブルにモデルを作成（マイグレーションなし）
rails generate model User --skip-migration

# 2. モデルで既存テーブル名を指定
class User < ApplicationRecord
  # テーブル名が規約と異なる場合
  self.table_name = "tbl_users"
  
  # 主キーが id 以外の場合
  self.primary_key = "user_id"
  
  # 既存カラムとRailsの規約をマッピング
  alias_attribute :created_at, :created_date
  alias_attribute :updated_at, :modified_date
end

# 3. 既存DBからschema.rbを生成
rake db:schema:dump

# 4. 既存テーブルの構造を維持しつつ、新しいカラムを追加
class AddColumnsToExistingTable < ActiveRecord::Migration[7.0]
  def change
    # 既存テーブルに新しいカラムを追加
    add_column :tbl_users, :rails_token, :string
    add_index :tbl_users, :rails_token, unique: true
  end
end
                        </pre>
                    </div>
                    
                    <h3>バリデーション高度テクニック <span class="badge advanced-badge">上級</span></h3>
                <div class="code-box">
                    <pre>
class User < ApplicationRecord
  # 基本的なバリデーション
  validates :email, presence: true, 
                    uniqueness: { case_sensitive: false },
                    format: { with: URI::MailTo::EMAIL_REGEXP }
  
  validates :age, numericality: { 
    greater_than: 0, 
    less_than: 150,
    allow_nil: true
  }
  
  # カスタムバリデーション
  validate :email_format_check
  validate :adult_user_for_premium, if: :premium_user?
  
  # 条件付きバリデーション
  validates :company, presence: true, if: :business_account?
  validates :hobby, presence: true, unless: :business_account?
  
  # コンテキスト別バリデーション
  validates :terms_accepted, acceptance: true, on: :create
  validates :current_password, presence: true, on: :update
  
  # バリデーションのスキップ
  validates :name, presence: true, unless: :skip_name_validation
  
  private
  
  def email_format_check
    return if email.blank?
    
    # より厳密なメールアドレス検証
    unless email.match?(/\A[\w+\-.]+@[a-z\d\-]+(\.[a-z\d\-]+)*\.[a-z]+\z/i)
      errors.add(:email, "正しいメールアドレス形式で入力してください")
    end
    
    # 禁止ドメインチェック
    forbidden_domains = %w[example.com test.com]
    domain = email.split('@').last
    if forbidden_domains.include?(domain)
      errors.add(:email, "このドメインは使用できません")
    end
  end
  
  def adult_user_for_premium
    if age.present? && age < 18
      errors.add(:age, "プレミアムアカウントは18歳以上である必要があります")
    end
  end
  
  def premium_user?
    account_type == 'premium'
  end
  
  def business_account?
    account_type == 'business'
  end
  
  attr_accessor :skip_name_validation
end
                    </pre>
                </div>
                </div>
                
                <!-- セキュリティ -->
                <div id="security" class="content-panel">
                    <h3>🔒 セキュリティ機能はMVCのどこに実装される？</h3>
                    <div class="important">
                        <strong>「既存のMVCは変えずに、どこにセキュリティを組み込むの？」という疑問への答え</strong>
                    </div>
                    
                    <div class="flow-chart">
                        <h4>セキュリティ機能の実装場所（Rails版）</h4>
                        
                        <div class="flow-item">👤 ユーザー</div>
                        <div>「/admin/users にアクセス」</div>
                        <span class="flow-arrow">↓ HTTPリクエスト</span>
                        
                        <div class="flow-item" style="background: linear-gradient(135deg, #f59e0b 0%, #ef4444 100%);">
                            🚪 Routes<br>
                            <small>（ルーティング層）</small>
                        </div>
                        <div style="background: #fef3c7; padding: 10px; border-radius: 8px; margin: 10px 0;">
                            <strong>❌ ここにはセキュリティは実装しない</strong><br>
                            URLとコントローラーのマッピングのみ
                        </div>
                        <span class="flow-arrow">↓</span>
                        
                        <div class="flow-item" style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);">
                            🛡️ <strong>before_action フィルター</strong><br>
                            <small>（コントローラーの前処理）</small>
                        </div>
                        <div style="background: #fee2e2; padding: 15px; border-radius: 8px; margin: 10px 0;">
                            <strong>✅ ここがセキュリティの主戦場！</strong><br>
                            • 認証チェック（ログインしているか？）<br>
                            • 認可チェック（管理者権限があるか？）<br>
                            • CSRFトークンの検証<br>
                            • セッションの有効性確認
                        </div>
                        <span class="flow-arrow">↓ 認証・認可をパス</span>
                        
                        <div class="flow-item">🤵 Controller<br><small>（実際の処理）</small></div>
                        <span class="flow-arrow">↓</span>
                        <div class="flow-item">👨‍🍳 Model</div>
                        <span class="flow-arrow">↓</span>
                        <div class="flow-item">🍽️ View</div>
                    </div>
                    
                    <div class="concept-box">
                        <h4>💡 実装の具体例：どのファイルに何を書く？</h4>
                        
                        <div class="code-box">
                            <pre>
<strong>1️⃣ app/controllers/application_controller.rb（全体の基盤）</strong>
class ApplicationController < ActionController::Base
  # CSRFプロテクション（自動で有効）
  protect_from_forgery with: :exception
  
  # 全コントローラー共通のセキュリティメソッド
  private
  
  def require_login
    unless logged_in?
      flash[:alert] = 'ログインが必要です'
      redirect_to login_path
    end
  end
  
  def require_admin
    unless current_user&.admin?
      flash[:alert] = '管理者権限が必要です'
      redirect_to root_path
    end
  end
  
  def logged_in?
    !!session[:user_id]
  end
  
  def current_user
    @current_user ||= User.find_by(id: session[:user_id])
  end
end

<strong>2️⃣ app/controllers/admin/users_controller.rb（個別のコントローラー）</strong>
class Admin::UsersController < ApplicationController
  # このコントローラーのすべてのアクション実行前にチェック
  before_action :require_login  # ← ログインチェック
  before_action :require_admin  # ← 管理者チェック
  
  def index
    # ここに到達する時点で、ログイン済み＆管理者であることが保証される
    @users = User.all
  end
  
  def destroy
    # 同様に、セキュリティチェック済み
    User.find(params[:id]).destroy
    redirect_to admin_users_path
  end
end

<strong>3️⃣ config/routes.rb（ルーティング - セキュリティ無関係）</strong>
Rails.application.routes.draw do
  # ルーティングは単純にURLとコントローラーを紐付けるだけ
  namespace :admin do
    resources :users
  end
  
  # セキュリティはここでは扱わない
  resources :posts
  get '/login', to: 'sessions#new'
  post '/login', to: 'sessions#create'
end
                            </pre>
                        </div>
                    </div>
                    
                    <div class="tip">
                        <h4>🎯 before_action の実行順序と条件分岐</h4>
                        <div class="code-box">
                            <pre>
class PostsController < ApplicationController
  # 特定のアクションだけ保護
  before_action :require_login, only: [:new, :create, :edit, :update, :destroy]
  # ↑ index と show は誰でも見れる
  
  # 所有者チェック（編集・削除時のみ）
  before_action :check_owner, only: [:edit, :update, :destroy]
  
  def index
    # ログイン不要
    @posts = Post.all
  end
  
  def show
    # ログイン不要
    @post = Post.find(params[:id])
  end
  
  def edit
    # require_login → check_owner の順でチェック済み
    # @post は check_owner で設定済み
  end
  
  private
  
  def check_owner
    @post = Post.find(params[:id])
    unless @post.user_id == current_user.id
      flash[:alert] = '他のユーザーの投稿は編集できません'
      redirect_to posts_path
    end
  end
end
                            </pre>
                        </div>
                    </div>
                    
                    <div class="warning">
                        <h4>⚠️ よくある間違い：Routesでセキュリティを実装しようとする</h4>
                        <div class="code-box">
                            <pre>
# ❌ 間違った実装（動作しない）
Rails.application.routes.draw do
  # Routesではセキュリティチェックはできない
  resources :admin, if: -> { current_user.admin? }  # ← これは動かない！
end

# ✅ 正しい実装
# Routes はシンプルに
Rails.application.routes.draw do
  namespace :admin do
    resources :users
  end
end

# セキュリティはコントローラーで
class Admin::BaseController < ApplicationController
  before_action :require_admin  # ← ここでチェック
end
                            </pre>
                        </div>
                    </div>
                    
                    <h3>🔧 他の主要機能もMVCを汚さない仕組み</h3>
                    <div class="concept-box">
                        <strong>「横断的関心事（Cross-cutting concerns）」の実装戦略</strong><br>
                        ログ、キャッシュ、国際化、エラーハンドリングなど、MVCの各層に跨る機能をどう実装する？
                    </div>
                    
                    <div class="flow-chart">
                        <h4>Rails における横断的関心事の実装場所</h4>
                        
                        <div style="display: grid; grid-template-columns: 1fr 2fr; gap: 20px; margin: 20px 0;">
                            <!-- 左側：MVC図 -->
                            <div style="text-align: center;">
                                <div class="flow-item layer-item" 
                                     style="background: #f59e0b; cursor: pointer;" 
                                     data-layer="routes"
                                     onmouseover="highlightLayer('routes')"
                                     onmouseout="unhighlightAll()">
                                    Routes
                                </div>
                                <span class="flow-arrow">↓</span>
                                <div class="flow-item layer-item" 
                                     style="background: #ef4444; cursor: pointer;" 
                                     data-layer="middleware"
                                     onmouseover="highlightLayer('middleware')"
                                     onmouseout="unhighlightAll()">
                                    Middleware
                                </div>
                                <span class="flow-arrow">↓</span>
                                <div class="flow-item layer-item" 
                                     style="background: #8b5cf6; cursor: pointer;" 
                                     data-layer="filter"
                                     onmouseover="highlightLayer('filter')"
                                     onmouseout="unhighlightAll()">
                                    before_action
                                </div>
                                <span class="flow-arrow">↓</span>
                                <div class="flow-item layer-item" 
                                     style="background: #10b981; cursor: pointer;" 
                                     data-layer="controller"
                                     onmouseover="highlightLayer('controller')"
                                     onmouseout="unhighlightAll()">
                                    Controller
                                </div>
                                <span class="flow-arrow">↓</span>
                                <div class="flow-item layer-item" 
                                     style="background: #3b82f6; cursor: pointer;" 
                                     data-layer="model"
                                     onmouseover="highlightLayer('model')"
                                     onmouseout="unhighlightAll()">
                                    Model
                                </div>
                                <span class="flow-arrow">↓</span>
                                <div class="flow-item layer-item" 
                                     style="background: #f97316; cursor: pointer;" 
                                     data-layer="view"
                                     onmouseover="highlightLayer('view')"
                                     onmouseout="unhighlightAll()">
                                    View
                                </div>
                            </div>
                            
                            <!-- 右側：機能配置 -->
                            <div style="text-align: left;">
                                <div class="layer-description" 
                                     data-layer="routes"
                                     style="background: #fef3c7; padding: 10px; margin: 5px 0; border-radius: 5px; cursor: pointer; transition: all 0.3s ease;"
                                     onmouseover="highlightLayer('routes')"
                                     onmouseout="unhighlightAll()">
                                    <strong>ルーティング層</strong><br>
                                    <small>• URL制約、サブドメイン分岐</small>
                                </div>
                                <div class="layer-description" 
                                     data-layer="middleware"
                                     style="background: #fecaca; padding: 10px; margin: 5px 0; border-radius: 5px; cursor: pointer; transition: all 0.3s ease;"
                                     onmouseover="highlightLayer('middleware')"
                                     onmouseout="unhighlightAll()">
                                    <strong>ミドルウェア層</strong><br>
                                    <small>• CORS、リクエスト圧縮、セッション管理</small>
                                </div>
                                <div class="layer-description" 
                                     data-layer="filter"
                                     style="background: #ddd6fe; padding: 10px; margin: 5px 0; border-radius: 5px; cursor: pointer; transition: all 0.3s ease;"
                                     onmouseover="highlightLayer('filter')"
                                     onmouseout="unhighlightAll()">
                                    <strong>フィルター層</strong><br>
                                    <small>• 認証、ログ、キャッシュ、国際化</small>
                                </div>
                                <div class="layer-description" 
                                     data-layer="controller"
                                     style="background: #dcfce7; padding: 10px; margin: 5px 0; border-radius: 5px; cursor: pointer; transition: all 0.3s ease;"
                                     onmouseover="highlightLayer('controller')"
                                     onmouseout="unhighlightAll()">
                                    <strong>コントローラー層</strong><br>
                                    <small>• 業務ロジック、エラーハンドリング</small>
                                </div>
                                <div class="layer-description" 
                                     data-layer="model"
                                     style="background: #dbeafe; padding: 10px; margin: 5px 0; border-radius: 5px; cursor: pointer; transition: all 0.3s ease;"
                                     onmouseover="highlightLayer('model')"
                                     onmouseout="unhighlightAll()">
                                    <strong>モデル層</strong><br>
                                    <small>• バリデーション、コールバック、トランザクション</small>
                                </div>
                                <div class="layer-description" 
                                     data-layer="view"
                                     style="background: #fed7aa; padding: 10px; margin: 5px 0; border-radius: 5px; cursor: pointer; transition: all 0.3s ease;"
                                     onmouseover="highlightLayer('view')"
                                     onmouseout="unhighlightAll()">
                                    <strong>ビュー層</strong><br>
                                    <small>• ヘルパー、パーシャル、レイアウト</small>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="tag-selector">
                        <span class="tag active" onclick="showConcernContent('logging')">ログ出力</span>
                        <span class="tag" onclick="showConcernContent('caching')">キャッシュ</span>
                        <span class="tag" onclick="showConcernContent('i18n')">国際化</span>
                        <span class="tag" onclick="showConcernContent('validation')">バリデーション</span>
                        <span class="tag" onclick="showConcernContent('comparison')">他FW比較</span>
                    </div>
                    
                    <div id="logging" class="content-panel active">
                        <h4>📝 ログ出力の実装</h4>
                        <div class="code-box">
                            <pre>
<strong>1️⃣ 自動ログ（MVCに手を加えない）</strong>
# config/application.rb で設定するだけ
config.log_level = :info

# 自動的にすべてのSQL、リクエスト、レンダリング時間が記録される
Started GET "/posts/1" for 127.0.0.1
Processing by PostsController#show as HTML
  Parameters: {"id"=>"1"}
  Post Load (0.2ms) SELECT "posts".* FROM "posts" WHERE "posts"."id" = ?
  Rendered posts/show.html.erb within layouts/application (2.3ms)
Completed 200 OK in 15ms (Views: 12.1ms | ActiveRecord: 0.2ms)

<strong>2️⃣ カスタムログ（before_actionで追加）</strong>
class ApplicationController < ActionController::Base
  before_action :log_user_activity
  
  private
  
  def log_user_activity
    if current_user
      Rails.logger.info "User #{current_user.id} accessed #{request.path}"
      # MVCの処理には一切影響しない
    end
  end
end

<strong>3️⃣ モデルでの自動ログ（コールバック使用）</strong>
class User < ApplicationRecord
  after_update :log_profile_change
  
  private
  
  def log_profile_change
    Rails.logger.info "User #{id} updated profile: #{changes}"
    # 業務ロジックとは分離
  end
end
                            </pre>
                        </div>
                    </div>
                    
                    <div id="caching" class="content-panel">
                        <h4>⚡ キャッシュの実装</h4>
                        <div class="code-box">
                            <pre>
<strong>1️⃣ ページキャッシュ（before_action）</strong>
class PostsController < ApplicationController
  before_action :set_cache_headers, only: [:show]
  
  def show
    @post = Post.find(params[:id])
    # キャッシュロジックはbefore_actionに隠蔽
  end
  
  private
  
  def set_cache_headers
    expires_in 1.hour, public: true
  end
end

<strong>2️⃣ フラグメントキャッシュ（View層）</strong>
<!-- app/views/posts/index.html.erb -->
<% @posts.each do |post| %>
  <% cache post do %>
    <!-- この部分がキャッシュされる -->
    <div class="post">
      <h3><%= post.title %></h3>
      <p><%= post.content %></p>
    </div>
  <% end %>
<% end %>

<strong>3️⃣ データキャッシュ（Model層）</strong>
class Post < ApplicationRecord
  def self.popular_posts
    Rails.cache.fetch("popular_posts", expires_in: 1.hour) do
      # 重い処理の結果をキャッシュ
      joins(:likes).group('posts.id').order('COUNT(likes.id) DESC').limit(10)
    end
  end
end
                            </pre>
                        </div>
                    </div>
                    
                    <div id="i18n" class="content-panel">
                        <h4>🌐 国際化（I18n）の実装</h4>
                        <div class="code-box">
                            <pre>
<strong>1️⃣ 言語切り替え（before_action）</strong>
class ApplicationController < ActionController::Base
  before_action :set_locale
  
  private
  
  def set_locale
    I18n.locale = params[:locale] || I18n.default_locale
    # コントローラーの処理は一切変更不要
  end
end

<strong>2️⃣ View での翻訳</strong>
<!-- MVCロジックは変更せず、表示のみ多言語化 -->
<h1><%= t('posts.index.title') %></h1>
<%= link_to t('posts.new.link'), new_post_path %>

<!-- config/locales/ja.yml -->
ja:
  posts:
    index:
      title: "投稿一覧"
    new:
      link: "新規投稿"

<strong>3️⃣ モデルでの多言語バリデーション</strong>
class Post < ApplicationRecord
  validates :title, presence: { message: I18n.t('errors.messages.blank') }
  # バリデーションロジック自体は変わらない
end
                            </pre>
                        </div>
                    </div>
                    
                    <div id="validation" class="content-panel">
                        <h4>✅ バリデーションの実装</h4>
                        <div class="code-box">
                            <pre>
<strong>1️⃣ モデル層でのデータ整合性</strong>
class User < ApplicationRecord
  # ビジネスロジックから分離されたデータ制約
  validates :email, presence: true, uniqueness: true
  validates :age, numericality: { greater_than: 0 }
  
  # カスタムバリデーション（業務ルール）
  validate :adult_email_format
  
  private
  
  def adult_email_format
    if age.present? && age >= 18 && email.present?
      unless email.match?(/\A[^@\s]+@[^@\s]+\z/)
        errors.add(:email, '成人の方は正式なメールアドレスが必要です')
      end
    end
  end
end

<strong>2️⃣ コントローラーでのリクエスト検証</strong>
class PostsController < ApplicationController
  before_action :validate_post_owner, only: [:edit, :update, :destroy]
  
  def update
    # バリデーション通過後の業務ロジック
    if @post.update(post_params)
      redirect_to @post
    else
      render :edit  # バリデーションエラーは自動表示
    end
  end
  
  private
  
  def validate_post_owner
    @post = Post.find(params[:id])
    unless @post.user == current_user
      redirect_to posts_path, alert: '権限がありません'
    end
  end
end

<strong>3️⃣ フロントエンド連携（自動生成）</strong>
<!-- Rails が自動でクライアントサイドバリデーションを生成 -->
<%= form_with model: @user do |form| %>
  <%= form.email_field :email, required: true %>
  <!-- HTML5 validation + Rails validation の二重チェック -->
<% end %>
                            </pre>
                        </div>
                    </div>
                    
                    <div id="comparison" class="content-panel">
                        <h4>🔄 他のフレームワークとの比較</h4>
                        
                        <table style="width: 100%; margin: 15px 0;">
                            <tr>
                                <th>機能</th>
                                <th>Rails</th>
                                <th>Spring (Java)</th>
                                <th>ASP.NET Core</th>
                                <th>Django</th>
                            </tr>
                            <tr>
                                <td><strong>認証・認可</strong></td>
                                <td>before_action フィルター</td>
                                <td>@PreAuthorize アノテーション</td>
                                <td>[Authorize] アトリビュート</td>
                                <td>@login_required デコレーター</td>
                            </tr>
                            <tr>
                                <td><strong>ログ出力</strong></td>
                                <td>Rails.logger + before_action</td>
                                <td>@Slf4j + AOP</td>
                                <td>ILogger + ActionFilter</td>
                                <td>logging + middleware</td>
                            </tr>
                            <tr>
                                <td><strong>キャッシュ</strong></td>
                                <td>Rails.cache + fragment</td>
                                <td>@Cacheable アノテーション</td>
                                <td>[ResponseCache] + IMemoryCache</td>
                                <td>@cache_page デコレーター</td>
                            </tr>
                            <tr>
                                <td><strong>トランザクション</strong></td>
                                <td>ActiveRecord::Base.transaction</td>
                                <td>@Transactional アノテーション</td>
                                <td>[Transaction] + DbContext</td>
                                <td>@transaction.atomic デコレーター</td>
                            </tr>
                            <tr>
                                <td><strong>バリデーション</strong></td>
                                <td>validates + before_action</td>
                                <td>@Valid + BindingResult</td>
                                <td>[Required] + ModelState</td>
                                <td>forms.Form + clean_*</td>
                            </tr>
                        </table>
                        
                        <div class="important">
                            <h4>🎯 共通するパターン：「関心の分離」</h4>
                            <ul style="text-align: left; margin: 10px 0;">
                                <li><strong>デコレーター/アノテーション</strong>：Java, C# は型安全性を活かした宣言的な実装</li>
                                <li><strong>フィルター/ミドルウェア</strong>：動的言語は実行時の柔軟性を活かした実装</li>
                                <li><strong>AOP（Aspect-Oriented Programming）</strong>：全言語で横断的関心事を分離</li>
                                <li><strong>設定ファイル分離</strong>：ビジネスロジックと環境設定の完全分離</li>
                            </ul>
                        </div>
                        
                        <div class="code-box">
                            <pre>
<strong>同じ機能の実装比較例：「ログイン必須チェック」</strong>

<strong>Rails (Ruby)</strong>
class PostsController < ApplicationController
  before_action :require_login, only: [:new, :create]
end

<strong>Spring Boot (Java)</strong>
@RestController
public class PostsController {
  @PreAuthorize("isAuthenticated()")
  @PostMapping("/posts")
  public ResponseEntity<Post> create(@RequestBody Post post) { }
}

<strong>ASP.NET Core (C#)</strong>
[ApiController]
public class PostsController : ControllerBase {
  [Authorize]
  [HttpPost]
  public IActionResult Create([FromBody] Post post) { }
}

<strong>Django (Python)</strong>
class PostsView(View):
  @method_decorator(login_required)
  def post(self, request):
      pass
                            </pre>
                        </div>
                        
                        <div class="tip">
                            <strong>💡 設計思想の収束</strong><br>
                            異なる言語・フレームワークでも、「MVCを汚さずに横断的機能を実装する」という課題に対して、
                            同じような解決策（フィルター、アノテーション、ミドルウェア）に収束しています。
                            これは優れた設計パターンの証拠です。
                        </div>
                    </div>
                    
                    <script>
                    function showConcernContent(panelId) {
                        // タグのアクティブ状態を更新
                        const tags = document.querySelectorAll('#security .tag-selector .tag');
                        tags.forEach(tag => {
                            tag.classList.remove('active');
                        });
                        event.target.classList.add('active');
                        
                        // コンテンツの表示切り替え
                        const panels = document.querySelectorAll('#security .content-panel');
                        panels.forEach(panel => {
                            if (panel.id === 'logging' || panel.id === 'caching' || panel.id === 'i18n' || panel.id === 'validation' || panel.id === 'comparison') {
                                panel.classList.remove('active');
                            }
                        });
                        const targetPanel = document.getElementById(panelId);
                        if (targetPanel) {
                            targetPanel.classList.add('active');
                        }
                    }
                    
                    function highlightLayer(layerName) {
                        // すべてをリセット
                        unhighlightAll();
                        
                        // 対応する要素をハイライト
                        const layerItems = document.querySelectorAll(`[data-layer="${layerName}"]`);
                        layerItems.forEach(item => {
                            item.style.transform = 'scale(1.05)';
                            item.style.boxShadow = '0 5px 20px rgba(0,0,0,0.3)';
                            item.style.borderLeft = '5px solid #ef4444';
                            item.style.fontWeight = 'bold';
                        });
                        
                        // 矢印も強調
                        const arrows = document.querySelectorAll('.flow-arrow');
                        arrows.forEach(arrow => {
                            arrow.style.opacity = '0.3';
                        });
                        
                        // 該当する矢印のみ強調
                        const layerIndex = getLayerIndex(layerName);
                        if (layerIndex >= 0 && layerIndex < arrows.length) {
                            arrows[layerIndex].style.opacity = '1';
                            arrows[layerIndex].style.fontSize = '35px';
                            arrows[layerIndex].style.color = '#ef4444';
                        }
                    }
                    
                    function unhighlightAll() {
                        // すべての層要素をリセット
                        const allLayerItems = document.querySelectorAll('.layer-item, .layer-description');
                        allLayerItems.forEach(item => {
                            item.style.transform = '';
                            item.style.boxShadow = '';
                            item.style.borderLeft = '';
                            item.style.fontWeight = '';
                        });
                        
                        // 矢印をリセット
                        const arrows = document.querySelectorAll('.flow-arrow');
                        arrows.forEach(arrow => {
                            arrow.style.opacity = '';
                            arrow.style.fontSize = '';
                            arrow.style.color = '';
                        });
                    }
                    
                    function getLayerIndex(layerName) {
                        const layers = ['routes', 'middleware', 'filter', 'controller', 'model', 'view'];
                        return layers.indexOf(layerName);
                    }
                    </script>
                    
                    <h3>PRGパターン（Post-Redirect-Get） <span class="badge">セキュリティ基本</span></h3>
                    <div class="concept-box">
                        <strong>フォーム送信後のページ更新問題を防ぐパターン</strong><br>
                        POSTリクエスト後は必ずリダイレクトして、二重送信を防ぎます。
                    </div>
                    
                    <div class="flow-chart">
                        <div class="flow-item">1. POST送信</div>
                        <span class="flow-arrow">↓</span>
                        <div class="flow-item" style="background: linear-gradient(135deg, #f59e0b 0%, #ef4444 100%);">2. データ処理</div>
                        <span class="flow-arrow">↓</span>
                        <div class="flow-item" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);">3. リダイレクト</div>
                        <span class="flow-arrow">↓</span>
                        <div class="flow-item">4. GET表示</div>
                    </div>
                    
                    <div class="code-box">
                        <pre>
class PostsController < ApplicationController
  def create
    @post = Post.new(post_params)
    
    if @post.save
      # ✅ PRGパターン：保存後はリダイレクト
      redirect_to @post, notice: '投稿を作成しました'
    else
      # ❌ エラー時は render でフォーム再表示（リダイレクトしない）
      render :new, status: :unprocessable_entity
    end
  end
  
  # ❌ 悪い例：POSTのまま表示
  def bad_create
    @post = Post.create(post_params)
    # renderだとURLがPOSTのまま残り、更新で二重送信される
    render :show
  end
end
                        </pre>
                    </div>
                    
                    <h3>CSRF対策 <span class="badge">セキュリティ必須</span></h3>
                    <div class="warning">
                        <strong>Cross-Site Request Forgery（クロスサイトリクエストフォージェリ）</strong><br>
                        悪意のあるサイトから、ユーザーの意図しないリクエストを送信させる攻撃
                    </div>
                    
                    <div class="code-box">
                        <pre>
# ApplicationControllerでCSRF保護を有効化（デフォルトで有効）
class ApplicationController < ActionController::Base
  protect_from_forgery with: :exception
  
  # APIの場合は null_session を使用
  # protect_from_forgery with: :null_session
end

# フォームには自動でCSRFトークンが埋め込まれる
<%= form_with model: @user do |form| %>
  <!-- 自動的に以下が生成される -->
  <!-- <input type="hidden" name="authenticity_token" value="..." /> -->
  <%= form.text_field :name %>
  <%= form.submit %>
<% end %>

# Ajaxリクエストの場合
$.ajax({
  url: '/posts',
  type: 'POST',
  headers: {
    'X-CSRF-Token': $('meta[name="csrf-token"]').attr('content')
  },
  data: { title: 'New Post' }
});
                        </pre>
                    </div>
                    
                    <h3>認証・認可の実装 <span class="badge advanced-badge">上級</span></h3>
                    
                    <div class="tip">
                        <h4>🔐 シングルサインオン（SSO）の実装</h4>
                        <div class="code-box">
                            <pre>
# Gemfile
gem 'omniauth'
gem 'omniauth-google-oauth2'
gem 'omniauth-github'
gem 'omniauth-rails_csrf_protection'

# config/initializers/omniauth.rb
Rails.application.config.middleware.use OmniAuth::Builder do
  provider :google_oauth2, ENV['GOOGLE_CLIENT_ID'], ENV['GOOGLE_CLIENT_SECRET']
  provider :github, ENV['GITHUB_KEY'], ENV['GITHUB_SECRET']
end

# SessionsController
class SessionsController < ApplicationController
  def omniauth
    auth = request.env['omniauth.auth']
    user = User.find_or_create_by(email: auth.info.email) do |u|
      u.name = auth.info.name
      u.provider = auth.provider
      u.uid = auth.uid
    end
    
    session[:user_id] = user.id
    redirect_to root_path, notice: 'ログインしました'
  end
end
                            </pre>
                        </div>
                    </div>
                    
                    <div class="important">
                        <h4>🛡️ リスクベース認証の実装</h4>
                        <p>不審なログイン試行を検知して追加認証を要求</p>
                        <div class="code-box">
                            <pre>
class SessionsController < ApplicationController
  def create
    user = User.find_by(email: params[:email])
    
    if user&.authenticate(params[:password])
      # リスク評価
      risk_score = calculate_risk_score(user, request)
      
      if risk_score > 0.7
        # 高リスク：2要素認証を要求
        session[:pending_user_id] = user.id
        user.send_verification_code!
        redirect_to verify_path
      elsif risk_score > 0.4
        # 中リスク：メール通知
        user.notify_suspicious_login(request)
        sign_in(user)
      else
        # 低リスク：通常ログイン
        sign_in(user)
      end
    else
      flash.now[:alert] = 'メールアドレスまたはパスワードが違います'
      render :new
    end
  end
  
  private
  
  def calculate_risk_score(user, request)
    score = 0.0
    
    # 新しいIPアドレスからのアクセス
    unless user.known_ips.include?(request.remote_ip)
      score += 0.3
    end
    
    # 新しいデバイス/ブラウザ
    unless user.known_user_agents.include?(request.user_agent)
      score += 0.2
    end
    
    # 異常な時間帯
    if Time.current.hour.between?(2, 5)
      score += 0.2
    end
    
    # 地理的に離れた場所からのアクセス
    if user.last_location && distance_from_last_location > 1000
      score += 0.3
    end
    
    # 連続ログイン失敗
    if user.failed_login_count > 3
      score += 0.4
    end
    
    [score, 1.0].min
  end
end
                            </pre>
                        </div>
                    </div>
                </div>
                
                <!-- ユーザビリティ -->
                <div id="usability" class="content-panel">
                    <h3>ログイン状態の保持 <span class="badge">UX向上</span></h3>
                    <div class="concept-box">
                        <strong>「ログイン状態を保持する」機能の実装</strong><br>
                        セキュアなRemember Me機能でユーザビリティを向上
                    </div>
                    
                    <div class="code-box">
                        <pre>
class User < ApplicationRecord
  has_secure_password
  
  # Remember Token の生成と保存
  def remember
    self.remember_token = SecureRandom.urlsafe_base64
    update_column(:remember_digest, digest(remember_token))
  end
  
  # Remember Token の検証
  def authenticated?(remember_token)
    return false if remember_digest.nil?
    BCrypt::Password.new(remember_digest).is_password?(remember_token)
  end
  
  # ログアウト時の処理
  def forget
    update_column(:remember_digest, nil)
  end
  
  private
  
  def digest(string)
    cost = ActiveModel::SecurePassword.min_cost ? BCrypt::Engine::MIN_COST : BCrypt::Engine.cost
    BCrypt::Password.create(string, cost: cost)
  end
end

class SessionsController < ApplicationController
  def create
    user = User.find_by(email: params[:email])
    
    if user&.authenticate(params[:password])
      log_in(user)
      
      # 「ログイン状態を保持する」にチェックがある場合
      if params[:remember_me] == '1'
        remember(user)
      else
        forget(user)
      end
      
      redirect_back_or root_path
    else
      render :new
    end
  end
  
  private
  
  def remember(user)
    user.remember
    cookies.permanent.encrypted[:user_id] = user.id
    cookies.permanent[:remember_token] = user.remember_token
  end
  
  def forget(user)
    user.forget
    cookies.delete(:user_id)
    cookies.delete(:remember_token)
  end
end
                        </pre>
                    </div>
                    
                    <h3>ログイン前ページへのリダイレクト <span class="badge">UX必須</span></h3>
                    <div class="tip">
                        <strong>ログイン後、元のページに戻る機能</strong><br>
                        ユーザーが保護されたページにアクセス → ログイン画面 → ログイン後に元のページへ
                    </div>
                    
                    <div class="code-box">
                        <pre>
class ApplicationController < ActionController::Base
  before_action :require_login
  
  private
  
  def require_login
    unless logged_in?
      store_location
      flash[:alert] = 'ログインが必要です'
      redirect_to login_path
    end
  end
  
  # アクセスしようとしたURLを保存
  def store_location
    session[:forwarding_url] = request.original_url if request.get?
  end
end

class SessionsController < ApplicationController
  skip_before_action :require_login, only: [:new, :create]
  
  def create
    user = User.find_by(email: params[:email])
    
    if user&.authenticate(params[:password])
      log_in(user)
      redirect_back_or(user)
    else
      render :new
    end
  end
  
  private
  
  # 保存されたURLか、デフォルトURLにリダイレクト
  def redirect_back_or(default)
    redirect_to(session[:forwarding_url] || default)
    session.delete(:forwarding_url)
  end
end

# 特定のページのみ保護したい場合
class PostsController < ApplicationController
  skip_before_action :require_login, only: [:index, :show]
  before_action :require_login, only: [:new, :create, :edit, :update, :destroy]
  
  # ...
end
                        </pre>
                    </div>
                    
                    <h3>セッション管理のベストプラクティス <span class="badge advanced-badge">上級</span></h3>
                    <div class="warning">
                        <strong>セッションのセキュリティ設定</strong>
                    </div>
                    
                    <div class="code-box">
                        <pre>
# config/initializers/session_store.rb
Rails.application.config.session_store :cookie_store,
  key: '_myapp_session',
  secure: Rails.env.production?,  # HTTPSでのみ送信
  httponly: true,                  # JavaScriptからアクセス不可
  same_site: :lax,                 # CSRF攻撃対策
  expire_after: 30.minutes         # セッションの有効期限

# ApplicationController
class ApplicationController < ActionController::Base
  # セッションタイムアウトの実装
  before_action :check_session_timeout
  
  private
  
  def check_session_timeout
    if logged_in?
      if session[:last_seen] && session[:last_seen] < 30.minutes.ago
        reset_session
        flash[:alert] = 'セッションがタイムアウトしました'
        redirect_to login_path
      else
        session[:last_seen] = Time.current
      end
    end
  end
  
  # 同時ログイン制限
  def enforce_single_session
    if current_user && current_user.session_token != session[:session_token]
      reset_session
      flash[:alert] = '別の場所からログインされました'
      redirect_to login_path
    end
  end
end
                        </pre>
                    </div>
                    
                    <div class="tip">
                        <strong>💡 実装のポイント</strong>
                        <ul style="text-align: left; margin: 10px 0;">
                            <li>セッションはデータベースに保存することも可能（ActiveRecord Session Store）</li>
                            <li>重要な操作前には再認証を要求する</li>
                            <li>ログイン履歴を記録して不審なアクセスを検知</li>
                            <li>定期的にセッションIDを再生成してセッション固定攻撃を防ぐ</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <script>
            function showAdvancedContent(panelId) {
                // タグのアクティブ状態を更新
                const tags = document.querySelectorAll('#advanced .tag-selector .tag');
                tags.forEach(tag => {
                    tag.classList.remove('active');
                });
                event.target.classList.add('active');
                
                // コンテンツの表示切り替え
                const panels = document.querySelectorAll('#advanced .content-panel');
                panels.forEach(panel => {
                    panel.classList.remove('active');
                });
                const targetPanel = document.getElementById(panelId);
                if (targetPanel) {
                    targetPanel.classList.add('active');
                }
            }
            </script>
            
            <div style="text-align: center; margin-top: 30px;">
                <button onclick="showMainContent('resources')" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 12px 24px; border-radius: 25px; font-size: 16px; cursor: pointer; transition: all 0.3s ease;">
                    次へ →
                </button>
            </div>
        </div>

        <!-- 学習リソース -->
        <div id="resources" class="content-section">
            <div class="section" id="community">
                <h2>📚 学習リソース & コミュニティ</h2>
                
                <h3>🎓 公式学習リソース</h3>
                <div class="official-resource">
                    <h4>Ruby公式</h4>
                    <ul>
                        <li><strong><a href="https://try.ruby-lang.org/" target="_blank">Try Ruby</a></strong> - 30分でRubyをマスター（インタラクティブ）</li>
                        <li><strong><a href="https://www.ruby-lang.org/ja/documentation/" target="_blank">公式ドキュメント</a></strong> - 最新バージョンのリファレンス</li>
                        <li><strong>20分ではじめるRuby</strong> - クイックスタートガイド</li>
                        <li><strong>他言語からのRuby入門</strong> - 経験者向け移行ガイド</li>
                    </ul>
                </div>

                <div class="official-resource">
                    <h4>Rails公式</h4>
                    <ul>
                        <li><strong><a href="https://railsguides.jp/" target="_blank">Rails ガイド</a></strong> - 日本語版公式ガイド</li>
                        <li><strong><a href="https://api.rubyonrails.org/" target="_blank">Rails API ドキュメント</a></strong> - 詳細なAPI仕様</li>
                        <li><strong><a href="https://guides.rubyonrails.org/getting_started.html" target="_blank">Getting Started</a></strong> - 公式チュートリアル</li>
                    </ul>
                </div>

                <h3>📖 推奨書籍</h3>
                <table>
                    <tr>
                        <th>書籍名</th>
                        <th>レベル</th>
                        <th>特徴</th>
                    </tr>
                    <tr>
                        <td><strong>プロを目指す人のためのRuby入門</strong></td>
                        <td><span class="badge beginner-badge">初心者</span></td>
                        <td>Ruby基礎文法を丁寧に解説</td>
                    </tr>
                    <tr>
                        <td><strong>現場で使える Ruby on Rails 5速習実践ガイド</strong></td>
                        <td><span class="badge">中級</span></td>
                        <td>実践的なRails開発手法</td>
                    </tr>
                    <tr>
                        <td><strong>リファクタリング:Rubyエディション</strong></td>
                        <td><span class="badge advanced-badge">上級</span></td>
                        <td>コード改善技術の習得</td>
                    </tr>
                    <tr>
                        <td><strong>メタプログラミングRuby</strong></td>
                        <td><span class="badge advanced-badge">上級</span></td>
                        <td>Rubyの高度な機能を理解</td>
                    </tr>
                </table>

                <h3>💻 推奨開発環境</h3>
                <table>
                    <tr>
                        <th>カテゴリ</th>
                        <th>ツール</th>
                        <th>理由</th>
                    </tr>
                    <tr>
                        <td><strong>エディタ</strong></td>
                        <td>
                            Visual Studio Code<br>
                            RubyMine<br>
                            Vim/Emacs
                        </td>
                        <td>
                            多機能・無料<br>
                            Ruby専用IDE<br>
                            高速・カスタマイズ性
                        </td>
                    </tr>
                    <tr>
                        <td><strong>ターミナル</strong></td>
                        <td>
                            iTerm2 (macOS)<br>
                            Windows Terminal<br>
                            標準ターミナル
                        </td>
                        <td>
                            高機能<br>
                            モダンな機能<br>
                            シンプル
                        </td>
                    </tr>
                    <tr>
                        <td><strong>バージョン管理</strong></td>
                        <td>
                            rbenv<br>
                            rvm<br>
                            asdf
                        </td>
                        <td>
                            シンプル・軽量<br>
                            多機能<br>
                            多言語対応
                        </td>
                    </tr>
                </table>

                <h3>🌟 コミュニティ</h3>
                <div class="example-box">
                    <h4>日本のRuby/Railsコミュニティ</h4>
                    <ul>
                        <li><strong>日本Rubyの会</strong> - Ruby普及活動の中心組織</li>
                        <li><strong>Rails Girls</strong> - 女性向けRailsワークショップ</li>
                        <li><strong>RubyKaigi</strong> - 年次Ruby国際会議</li>
                        <li><strong>地域Ruby会議</strong> - 各地域でのRuby交流</li>
                        <li><strong>オンラインコミュニティ</strong> - Discord、Slack等</li>
                    </ul>
                </div>

                <h3>🎯 学習ロードマップ</h3>
                <div class="flow-chart">
                    <div><strong>Step 1: Ruby基礎</strong></div>
                    <div style="font-size: 0.9rem;">Try Ruby → 基本文法 → 小さなプログラム作成</div>
                    <span class="flow-arrow">↓ 2-4週間</span>
                    
                    <div><strong>Step 2: Rails入門</strong></div>
                    <div style="font-size: 0.9rem;">Rails Tutorial → MVC理解 → 簡単なWebアプリ</div>
                    <span class="flow-arrow">↓ 1-2ヶ月</span>
                    
                    <div><strong>Step 3: 実践開発</strong></div>
                    <div style="font-size: 0.9rem;">オリジナルアプリ → テスト → デプロイ</div>
                    <span class="flow-arrow">↓ 2-3ヶ月</span>
                    
                    <div><strong>Step 4: 応用技術</strong></div>
                    <div style="font-size: 0.9rem;">API開発 → パフォーマンス → セキュリティ</div>
                    <span class="flow-arrow">↓ 継続的学習</span>
                    
                    <div><strong>🎉 実践レベル</strong></div>
                </div>

                <div class="tip">
                    <h4>💡 効果的な学習のコツ</h4>
                    <ul>
                        <li><strong>手を動かす</strong>：読むだけでなく実際にコードを書く</li>
                        <li><strong>小さく始める</strong>：完璧を目指さず、動くものを作る</li>
                        <li><strong>エラーを恐れない</strong>：エラーメッセージは学習の宝庫</li>
                        <li><strong>コミュニティ参加</strong>：質問や情報交換で成長加速</li>
                        <li><strong>継続的学習</strong>：少しずつでも毎日続ける</li>
                    </ul>
                </div>
            </div>

            <div class="section">
                <h2>🚀 今すぐ始めよう！</h2>
                
                <div class="interactive-demo">
                    <h3>🎮 今すぐRubyを体験</h3>
                    <p>ブラウザだけで始められる！</p>
                    <button class="demo-button" onclick="window.open('https://try.ruby-lang.org/', '_blank')">
                        Try Ruby で今すぐ体験
                    </button>
                    <button class="demo-button" onclick="window.open('https://railsguides.jp/', '_blank')">
                        Rails ガイドを読む
                    </button>
                </div>

                <div class="important">
                    <h4>🎯 最初の一歩</h4>
                    <p>
                        プログラミングの世界に飛び込むのは勇気がいりますが、Rubyは初心者に優しい言語です。<br>
                        「プログラマーの幸福」を重視して設計されているので、楽しみながら学習できます。
                    </p>
                    <p>
                        <strong>今日から始めて、1ヶ月後には小さなWebアプリが作れるようになっています！</strong>
                    </p>
                </div>
            </div>
            
            <div style="text-align: center; margin-top: 30px;">
                <button onclick="showMainContent('ruby-intro')" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 12px 24px; border-radius: 25px; font-size: 16px; cursor: pointer; transition: all 0.3s ease;">
                    最初に戻る ↺
                </button>
            </div>
        </div>
        
        <!-- テスト・品質管理 -->
        <div id="testing-tools" class="content-section">
            <div class="section" id="test-frameworks">
                <h2>🧪 テスト・品質管理ツール</h2>
                
                <h3>🔬 テストフレームワーク</h3>
                <div class="code-block">
                    <div class="code-header">
                        <span class="filename">主要なテストツール</span>
                    </div>
                    <pre><code><span class="comment"># Gemfile</span>
group :test do
  gem 'rspec-rails'        # BDD形式テストフレームワーク
  gem 'capybara'          # E2Eテスト用ブラウザ操作
  gem 'factory_bot_rails' # テストデータ生成
  gem 'database_cleaner-active_record' # テストDB管理
  gem 'vcr'               # 外部APIレスポンスの記録・再生
  gem 'webmock'           # HTTPリクエストのモック化
  gem 'shoulda-matchers'  # RSpec用マッチャー集
  gem 'faker'             # 偽データ生成
  gem 'timecop'           # 時間制御（テスト用）
end</code></pre>
                </div>

                <div class="tip">
                    <h4>💡 RSpec vs Minitest</h4>
                    <p><strong>RSpec</strong>: BDD形式、記述的でわかりやすいDSL、豊富なマッチャー</p>
                    <p><strong>Minitest</strong>: Rails標準、シンプル、高速、学習コストが低い</p>
                </div>

                <div class="code-block">
                    <div class="code-header">
                        <span class="filename">RSpec基本例</span>
                    </div>
                    <pre><code><span class="comment"># spec/models/user_spec.rb</span>
require 'rails_helper'

RSpec.describe User, type: :model do
  describe 'validations' do
    it { should validate_presence_of(:name) }
    it { should validate_uniqueness_of(:email) }
    it { should validate_length_of(:password).is_at_least(6) }
  end

  describe 'associations' do
    it { should have_many(:posts).dependent(:destroy) }
  end

  describe '#full_name' do
    let(:user) { build(:user, first_name: 'John', last_name: 'Doe') }
    
    it 'returns the full name' do
      expect(user.full_name).to eq('John Doe')
    end
  end
end</code></pre>
                </div>

                <div class="code-block">
                    <div class="code-header">
                        <span class="filename">Capybara E2Eテスト例</span>
                    </div>
                    <pre><code><span class="comment"># spec/features/user_registration_spec.rb</span>
require 'rails_helper'

RSpec.feature 'User Registration', type: :feature do
  scenario 'successful registration' do
    visit new_user_registration_path
    
    fill_in 'Email', with: 'test@example.com'
    fill_in 'Password', with: 'password123'
    fill_in 'Password confirmation', with: 'password123'
    
    click_button 'Sign up'
    
    expect(page).to have_content('Welcome! You have signed up successfully.')
    expect(current_path).to eq(root_path)
  end
end</code></pre>
                </div>

                <h3>🔍 静的解析・コード品質</h3>
                <div class="code-block">
                    <div class="code-header">
                        <span class="filename">RuboCop設定</span>
                    </div>
                    <pre><code><span class="comment"># Gemfile</span>
group :development do
  gem 'rubocop', require: false
  gem 'rubocop-rails', require: false
  gem 'rubocop-rspec', require: false
  gem 'rubocop-performance', require: false
  gem 'reek'                    # コードの臭い検出
  gem 'brakeman'               # セキュリティ脆弱性検査
  gem 'rails_best_practices'   # Railsベストプラクティス
end

<span class="comment"># .rubocop.yml</span>
require:
  - rubocop-rails
  - rubocop-rspec
  - rubocop-performance

AllCops:
  TargetRubyVersion: 3.2
  NewCops: enable
  Exclude:
    - 'db/schema.rb'
    - 'vendor/**/*'
    - 'node_modules/**/*'

Style/Documentation:
  Enabled: false

Metrics/LineLength:
  Max: 120</code></pre>
                </div>

                <div class="code-block">
                    <div class="code-header">
                        <span class="filename">コマンド例</span>
                    </div>
                    <pre><code><span class="comment"># コード品質チェック</span>
bundle exec rubocop                    # スタイルチェック
bundle exec rubocop -a                 # 自動修正
bundle exec reek app/                  # コードの臭い検出
bundle exec brakeman                   # セキュリティチェック
bundle exec rails_best_practices .     # ベストプラクティスチェック

<span class="comment"># テスト実行</span>
bundle exec rspec                      # 全テスト実行
bundle exec rspec spec/models/         # モデルテストのみ
bundle exec rspec --format documentation # 詳細出力</code></pre>
                </div>

                <h3>🛠️ 開発支援Gem</h3>
                <div class="code-block">
                    <div class="code-header">
                        <span class="filename">便利な開発用Gem</span>
                    </div>
                    <pre><code><span class="comment"># Gemfile</span>
group :development do
  <span class="comment"># デバッグ・開発支援</span>
  gem 'pry-rails'              # 強力なデバッガー
  gem 'pry-byebug'            # ステップ実行
  gem 'better_errors'         # エラー画面改善
  gem 'binding_of_caller'     # better_errorsでREPL使用

  <span class="comment"># パフォーマンス・最適化</span>
  gem 'bullet'                # N+1問題検出
  gem 'rack-mini-profiler'    # パフォーマンス分析
  gem 'memory_profiler'       # メモリ使用量分析
  
  <span class="comment"># コード支援</span>
  gem 'annotate'              # モデルにスキーマ情報追加
  gem 'letter_opener'         # 開発環境でメール確認
  gem 'listen'                # ファイル変更検知
  
  <span class="comment"># 高速化</span>
  gem 'bootsnap', require: false    # 起動高速化
  gem 'spring'                      # プリローダー
  gem 'spring-watcher-listen'       # Spring用ファイル監視
end

group :test do
  gem 'simplecov', require: false   # カバレッジ測定
  gem 'simplecov-html'             # HTML形式レポート
end</code></pre>
                </div>

                <div class="tip">
                    <h4>💡 開発効率化のTips</h4>
                    <p><strong>Bullet</strong>: N+1問題を自動検出してアラート表示</p>
                    <p><strong>Annotate</strong>: `rails g annotate:install`でモデルに自動でスキーマ情報追加</p>
                    <p><strong>Letter Opener</strong>: 送信メールをブラウザで確認可能</p>
                    <p><strong>Pry</strong>: `binding.pry`でブレークポイント設置、IRBより高機能</p>
                </div>

            </div>
            

                <h3>⚡ パフォーマンス最適化</h3>
                <div class="code-block">
                    <div class="code-header">
                        <span class="filename">パフォーマンス分析</span>
                    </div>
                    <pre><code><span class="comment"># メモリ使用量分析</span>
gem 'derailed_benchmarks'

<span class="comment"># 使用例</span>
<span class="comment"># コントローラーアクションのメモリ使用量測定</span>
bundle exec derailed exec perf:mem_over_time

<span class="comment"># アプリ起動時のメモリ使用量</span>
bundle exec derailed bundle:mem

<span class="comment"># Rack Mini Profiler（開発環境で自動有効）</span>
<span class="comment"># URL末尾に ?pp=help でヘルプ表示</span>
<span class="comment"># ?pp=disable で無効化</span></code></pre>
                </div>

                <div class="code-block">
                    <div class="code-header">
                        <span class="filename">N+1問題対策例</span>
                    </div>
                    <pre><code><span class="comment"># ❌ N+1問題のあるコード</span>
@users = User.all
@users.each do |user|
  puts user.posts.count  # 各userに対してクエリが発行される
end

<span class="comment"># ✅ includes で解決</span>
@users = User.includes(:posts)
@users.each do |user|
  puts user.posts.count  # 事前に読み込み済み
end

<span class="comment"># ✅ counter_cache でさらに最適化</span>
class User < ApplicationRecord
  has_many :posts
end

class Post < ApplicationRecord
  belongs_to :user, counter_cache: true  # posts_count カラム必要
end</code></pre>
                </div>

                <h3>🚀 CI/CD統合</h3>
                <div class="code-block">
                    <div class="code-header">
                        <span class="filename">GitHub Actions設定例</span>
                    </div>
                    <pre><code><span class="comment"># .github/workflows/test.yml</span>
name: Test Suite

on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    
    services:
      postgres:
        image: postgres:13
        env:
          POSTGRES_PASSWORD: postgres
        options: >-
          --health-cmd pg_isready
          --health-interval 10s
          --health-timeout 5s
          --health-retries 5

    steps:
    - uses: actions/checkout@v2
    
    - name: Set up Ruby
      uses: ruby/setup-ruby@v1
      with:
        ruby-version: 3.2
        bundler-cache: true
        
    - name: Setup Database
      run: |
        bundle exec rails db:create
        bundle exec rails db:migrate
      env:
        DATABASE_URL: postgres://postgres:postgres@localhost:5432/test
        
    - name: Run RuboCop
      run: bundle exec rubocop
      
    - name: Run Security Check
      run: bundle exec brakeman
      
    - name: Run Tests
      run: bundle exec rspec
      env:
        DATABASE_URL: postgres://postgres:postgres@localhost:5432/test</code></pre>
                </div>

                <div class="warning">
                    <h4>⚠️ テスト運用の注意点</h4>
                    <ul>
                        <li><strong>テストデータベース分離</strong>: 本番・開発・テストでDB完全分離</li>
                        <li><strong>外部API依存排除</strong>: VCRやWebMockで外部通信を記録・モック化</li>
                        <li><strong>テスト実行時間</strong>: 遅いテストは並列実行やFactory最適化で改善</li>
                        <li><strong>カバレッジ目標</strong>: 80-90%を目指すが、100%に固執しない</li>
                    </ul>
                </div>

                <h3>🌐 他言語のテストツール比較</h3>
                <div class="code-block">
                    <div class="code-header">
                        <span class="filename">JavaScript/TypeScript</span>
                    </div>
                    <pre><code><span class="comment"># 単体テスト</span>
- <strong>Jest</strong>: Facebook製、最も人気、スナップショットテスト対応
- <strong>Vitest</strong>: Vite対応、高速、Jest互換API
- <strong>Mocha + Chai</strong>: 柔軟、プラガブル

<span class="comment"># E2Eテスト</span>
- <strong>Playwright</strong>: Microsoft製、複数ブラウザ対応、自動待機
- <strong>Cypress</strong>: デバッグしやすい、時間旅行デバッグ
- <strong>Puppeteer</strong>: Chrome自動化、ヘッドレス対応

<span class="comment"># Jest例</span>
describe('Calculator', () => {
  test('adds 1 + 2 to equal 3', () => {
    expect(add(1, 2)).toBe(3);
  });
  
  test('async data fetch', async () => {
    const data = await fetchData();
    expect(data.name).toBe('John');
  });
});</code></pre>
                </div>

                <div class="code-block">
                    <div class="code-header">
                        <span class="filename">Python</span>
                    </div>
                    <pre><code><span class="comment"># 単体テスト</span>
- <strong>pytest</strong>: 最も人気、豊富なプラグイン、フィクスチャ機能
- <strong>unittest</strong>: 標準ライブラリ、JUnit風
- <strong>nose2</strong>: unittestの拡張

<span class="comment"># E2Eテスト  </span>
- <strong>Selenium</strong>: 標準的、多言語対応
- <strong>Playwright for Python</strong>: 高速、信頼性高い

<span class="comment"># pytest例</span>
import pytest

def test_addition():
    assert add(2, 3) == 5

@pytest.fixture
def db_connection():
    conn = create_connection()
    yield conn
    conn.close()

def test_user_creation(db_connection):
    user = User.create(name="Alice", db=db_connection)
    assert user.id is not None</code></pre>
                </div>

                <div class="code-block">
                    <div class="code-header">
                        <span class="filename">Java</span>
                    </div>
                    <pre><code><span class="comment"># 単体テスト</span>
- <strong>JUnit 5</strong>: 標準、アノテーション豊富
- <strong>TestNG</strong>: 並列実行、データ駆動テスト
- <strong>Mockito</strong>: モックフレームワーク

<span class="comment"># JUnit 5例</span>
@Test
@DisplayName("計算のテスト")
void testCalculation() {
    assertEquals(5, calculator.add(2, 3));
}

@ParameterizedTest
@ValueSource(strings = {"hello", "world"})
void testWithParameters(String word) {
    assertTrue(word.length() > 0);
}</code></pre>
                </div>

                <div class="code-block">
                    <div class="code-header">
                        <span class="filename">Go</span>
                    </div>
                    <pre><code><span class="comment"># 標準テスト</span>
- <strong>testing</strong>: 標準パッケージ、シンプル
- <strong>Testify</strong>: アサーション、モック機能
- <strong>Ginkgo</strong>: BDD形式

<span class="comment"># testing例</span>
func TestAdd(t *testing.T) {
    result := Add(2, 3)
    if result != 5 {
        t.Errorf("Expected 5, got %d", result)
    }
}

<span class="comment"># テーブル駆動テスト</span>
func TestMultiple(t *testing.T) {
    tests := []struct {
        name string
        a, b int
        want int
    }{
        {"positive", 2, 3, 5},
        {"negative", -1, -1, -2},
    }
    for _, tt := range tests {
        t.Run(tt.name, func(t *testing.T) {
            if got := Add(tt.a, tt.b); got != tt.want {
                t.Errorf("Add() = %v, want %v", got, tt.want)
            }
        })
    }
}</code></pre>
                </div>

                <h3>🎯 実践的なテストシナリオ</h3>
                <div class="code-block">
                    <div class="code-header">
                        <span class="filename">複雑なユーザーフロー（打刻システム例）</span>
                    </div>
                    <pre><code><span class="comment"># RSpec + Capybara での連続操作テスト</span>
RSpec.feature '勤怠管理システム', type: :feature do
  let!(:user) { create(:user, email: 'test@example.com') }
  let!(:previous_record) { create(:attendance, user: user, 
                                  check_in: 1.day.ago.at_beginning_of_day + 9.hours,
                                  check_out: 1.day.ago.at_beginning_of_day + 18.hours) }
  
  scenario '連続した打刻操作' do
    <span class="comment"># ログイン</span>
    visit login_path
    fill_in 'メールアドレス', with: 'test@example.com'
    fill_in 'パスワード', with: 'password123'
    click_button 'ログイン'
    
    <span class="comment"># 前日の記録確認</span>
    expect(page).to have_content('前回の退勤: 18:00')
    
    <span class="comment"># 出勤打刻</span>
    click_button '出勤'
    expect(page).to have_content('出勤しました')
    expect(page).to have_button('退勤', disabled: false)
    expect(page).not_to have_button('出勤')
    
    <span class="comment"># DB確認</span>
    expect(user.attendances.today.first.check_in).to be_present
    
    <span class="comment"># 時間を進める（Timecop使用）</span>
    Timecop.travel(4.hours.from_now) do
      visit current_path
      
      <span class="comment"># 休憩開始</span>
      click_button '休憩開始'
      expect(page).to have_content('休憩中')
      
      Timecop.travel(1.hour.from_now) do
        <span class="comment"># 休憩終了</span>
        click_button '休憩終了'
        expect(page).to have_content('休憩時間: 1時間')
      end
    end
    
    <span class="comment"># 退勤打刻</span>
    click_button '退勤'
    expect(page).to have_content('お疲れ様でした')
    
    <span class="comment"># 最終的なDB状態確認</span>
    attendance = user.attendances.today.first
    expect(attendance.check_out).to be_present
    expect(attendance.break_time).to eq(60) # 分単位
  end
end</code></pre>
                </div>

                <div class="code-block">
                    <div class="code-header">
                        <span class="filename">DBトランザクションを含むテスト</span>
                    </div>
                    <pre><code><span class="comment"># 在庫管理システムのテスト（同時実行・ロック処理）</span>
RSpec.describe OrderService, type: :service do
  describe '#process_order' do
    let!(:product) { create(:product, stock: 10, price: 1000) }
    let(:user) { create(:user, balance: 5000) }
    
    context '正常な注文処理' do
      it 'トランザクション内で在庫と残高を更新' do
        service = OrderService.new(user, product, quantity: 3)
        
        expect {
          result = service.process_order
          expect(result).to be_success
        }.to change { product.reload.stock }.from(10).to(7)
         .and change { user.reload.balance }.from(5000).to(2000)
         .and change { Order.count }.by(1)
         .and change { OrderHistory.count }.by(1)
      end
    end
    
    context '同時注文での在庫制御' do
      it '楽観的ロックで在庫超過を防ぐ' do
        <span class="comment"># 2つの同時注文をシミュレート</span>
        product_copy1 = Product.find(product.id)
        product_copy2 = Product.find(product.id)
        
        <span class="comment"># 最初の注文で在庫を7個減らす</span>
        product_copy1.update!(stock: 3)
        
        <span class="comment"># 2番目の注文は失敗するべき（在庫不足）</span>
        expect {
          product_copy2.with_lock do
            product_copy2.decrement!(:stock, 5)
          end
        }.to raise_error(ActiveRecord::StaleObjectError)
      end
    end
    
    context 'ロールバック処理' do
      it '支払い失敗時に全ての変更をロールバック' do
        <span class="comment"># 残高不足のユーザー</span>
        poor_user = create(:user, balance: 100)
        
        expect {
          service = OrderService.new(poor_user, product, quantity: 3)
          result = service.process_order
          expect(result).to be_failure
          expect(result.error).to eq('残高不足')
        }.not_to change { [product.reload.stock, 
                          poor_user.reload.balance, 
                          Order.count] }
      end
    end
  end
end</code></pre>
                </div>

                <div class="code-block">
                    <div class="code-header">
                        <span class="filename">外部API連携テスト（VCR使用）</span>
                    </div>
                    <pre><code><span class="comment"># 天気API連携のテスト</span>
RSpec.describe WeatherService, type: :service do
  describe '#get_forecast' do
    <span class="comment"># VCRで実際のAPIレスポンスを記録・再生</span>
    it '天気予報を取得して処理', vcr: { cassette_name: 'weather_tokyo' } do
      service = WeatherService.new(city: 'Tokyo')
      forecast = service.get_forecast
      
      expect(forecast).to include(
        temperature: be_a(Numeric),
        description: be_a(String),
        humidity: be_between(0, 100)
      )
      
      <span class="comment"># キャッシュの動作確認</span>
      expect(Rails.cache.read('weather:Tokyo')).to eq(forecast)
      
      <span class="comment"># 2回目はAPIを呼ばない（VCRが1回しか記録していないことを確認）</span>
      cached_forecast = service.get_forecast
      expect(cached_forecast).to eq(forecast)
    end
    
    context 'API障害時' do
      it 'フォールバック処理' do
        <span class="comment"># WebMockで障害をシミュレート</span>
        stub_request(:get, /api.weather.com/)
          .to_return(status: 503)
        
        service = WeatherService.new(city: 'Tokyo')
        forecast = service.get_forecast
        
        expect(forecast).to eq({
          temperature: nil,
          description: 'サービス一時利用不可',
          cached: true
        })
      end
    end
  end
end</code></pre>
                </div>

                <div class="code-block">
                    <div class="code-header">
                        <span class="filename">Playwright での画面遷移テスト（JavaScript）</span>
                    </div>
                    <pre><code><span class="comment">// ECサイトの購入フロー完全テスト</span>
import { test, expect } from '@playwright/test';

test.describe('購入フロー', () => {
  test.beforeEach(async ({ page }) => {
    <span class="comment">// テストデータセットアップ</span>
    await page.goto('/api/test/reset');
    await page.goto('/api/test/seed');
  });
  
  test('商品検索から購入完了まで', async ({ page }) => {
    <span class="comment">// 1. ログイン</span>
    await page.goto('/login');
    await page.fill('[name="email"]', 'test@example.com');
    await page.fill('[name="password"]', 'password');
    await page.click('button[type="submit"]');
    
    <span class="comment">// ログイン成功を確認</span>
    await expect(page).toHaveURL('/dashboard');
    await expect(page.locator('.user-name')).toContainText('テストユーザー');
    
    <span class="comment">// 2. 商品検索</span>
    await page.fill('[placeholder="商品を検索"]', 'ノートPC');
    await page.press('[placeholder="商品を検索"]', 'Enter');
    
    <span class="comment">// 検索結果を確認</span>
    await expect(page.locator('.search-results')).toBeVisible();
    const results = page.locator('.product-card');
    await expect(results).toHaveCount(5);
    
    <span class="comment">// 3. 商品詳細確認</span>
    await results.first().click();
    await expect(page).toHaveURL(/\/products\/\d+/);
    
    <span class="comment">// 在庫確認</span>
    const stockText = await page.locator('.stock-info').textContent();
    expect(parseInt(stockText)).toBeGreaterThan(0);
    
    <span class="comment">// 4. カートに追加</span>
    await page.selectOption('select[name="quantity"]', '2');
    await page.click('button:has-text("カートに追加")');
    
    <span class="comment">// トースト通知を確認</span>
    await expect(page.locator('.toast-success')).toContainText('カートに追加しました');
    
    <span class="comment">// カートアイコンの数字更新を確認</span>
    await expect(page.locator('.cart-badge')).toContainText('2');
    
    <span class="comment">// 5. チェックアウト</span>
    await page.click('[aria-label="カート"]');
    await expect(page.locator('.cart-item')).toHaveCount(1);
    await page.click('button:has-text("購入手続きへ")');
    
    <span class="comment">// 6. 配送先入力</span>
    await page.fill('[name="zipcode"]', '100-0001');
    await page.click('button:has-text("住所自動入力")');
    
    <span class="comment">// 自動入力の完了を待つ</span>
    await expect(page.locator('[name="prefecture"]')).toHaveValue('東京都');
    
    await page.fill('[name="address"]', '千代田区1-1-1');
    await page.fill('[name="phone"]', '03-1234-5678');
    
    <span class="comment">// 7. 支払い方法選択</span>
    await page.click('input[value="credit"]');
    await page.fill('[name="card-number"]', '4242 4242 4242 4242');
    await page.fill('[name="card-expiry"]', '12/25');
    await page.fill('[name="card-cvc"]', '123');
    
    <span class="comment">// 8. 注文確認</span>
    await page.click('button:has-text("注文内容を確認")');
    
    <span class="comment">// 合計金額の確認</span>
    const total = await page.locator('.order-total').textContent();
    expect(total).toMatch(/¥[\d,]+/);
    
    <span class="comment">// 9. 注文確定</span>
    await page.click('button:has-text("注文を確定する")');
    
    <span class="comment">// 完了画面の確認</span>
    await expect(page).toHaveURL('/orders/complete');
    await expect(page.locator('h1')).toContainText('ご注文ありがとうございました');
    
    <span class="comment">// 注文番号の取得</span>
    const orderNumber = await page.locator('.order-number').textContent();
    expect(orderNumber).toMatch(/^ORD-\d{10}$/);
    
    <span class="comment">// 10. 注文履歴で確認</span>
    await page.click('a:has-text("注文履歴を見る")');
    await expect(page.locator(`[data-order="${orderNumber}"]`)).toBeVisible();
  });
  
  test('在庫切れ商品の購入防止', async ({ page, context }) => {
    <span class="comment">// 2つのブラウザタブで同時購入をシミュレート</span>
    const page2 = await context.newPage();
    
    <span class="comment">// 両方のタブで同じ商品（在庫1個）を開く</span>
    await Promise.all([
      page.goto('/products/limited-item'),
      page2.goto('/products/limited-item')
    ]);
    
    <span class="comment">// 最初のタブで購入</span>
    await page.click('button:has-text("今すぐ購入")');
    await page.click('button:has-text("購入確定")');
    await expect(page.locator('.success')).toBeVisible();
    
    <span class="comment">// 2番目のタブで購入試行</span>
    await page2.click('button:has-text("今すぐ購入")');
    await expect(page2.locator('.error')).toContainText('在庫切れ');
  });
});</code></pre>
                </div>

                <div class="tip">
                    <h4>💡 テストツール選択のポイント</h4>
                    <p><strong>単体テスト</strong>: 言語標準のツールから始めて、必要に応じて高機能なものへ</p>
                    <p><strong>E2Eテスト</strong>: Playwright（高速・安定）、Cypress（デバッグ容易）から選択</p>
                    <p><strong>API テスト</strong>: Postman/Insomnia でまず手動確認、その後自動化</p>
                    <p><strong>負荷テスト</strong>: K6（開発者向け）、JMeter（GUIあり）が主流</p>
                </div>

                <div class="warning">
                    <h4>⚠️ テスト設計の重要ポイント</h4>
                    <ul>
                        <li><strong>テストの独立性</strong>: 各テストは他のテストに依存しない</li>
                        <li><strong>データの初期化</strong>: beforeEach/afterEachで確実にクリーンアップ</li>
                        <li><strong>非同期処理の待機</strong>: 適切なwait/expectを使用（sleep避ける）</li>
                        <li><strong>テストの保守性</strong>: Page Object Patternなどで重複を削減</li>
                        <li><strong>flaky test対策</strong>: リトライ機能、適切なタイムアウト設定</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        function showMainContent(sectionId) {
            // すべてのナビタブから active を削除
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // すべてのコンテンツセクションを非表示
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            
            // 対応するタブをアクティブに（event.targetがない場合の対応）
            const targetTab = document.querySelector(`[onclick="showMainContent('${sectionId}')"]`);
            if (targetTab) {
                targetTab.classList.add('active');
            }
            
            // 選択されたセクションをアクティブに
            const targetSection = document.getElementById(sectionId);
            targetSection.classList.add('active');
            
            // セクションの先頭にスムーズスクロール
            targetSection.scrollIntoView({ 
                behavior: 'smooth', 
                block: 'start' 
            });
            
            // プログレスバーを更新
            updateProgressBar();
        }
        
        function showRubyContent(contentId) {
            // Ruby文法セクション内のタブ切り替え
            document.querySelectorAll('#ruby-syntax .tag').forEach(tag => {
                tag.classList.remove('active');
            });
            document.querySelectorAll('#ruby-syntax .content-panel').forEach(panel => {
                panel.classList.remove('active');
            });
            
            event.target.classList.add('active');
            document.getElementById(contentId).classList.add('active');
        }
        
        function showEnvContent(contentId) {
            // 環境設定セクション内のタブ切り替え
            document.querySelectorAll('#windows, #mac, #linux').forEach(panel => {
                panel.classList.remove('active');
            });
            document.querySelectorAll('.tag-selector .tag').forEach(tag => {
                tag.classList.remove('active');
            });
            
            event.target.classList.add('active');
            document.getElementById(contentId).classList.add('active');
        }

        function showGemContent(contentId) {
            // Gem紹介セクション内のタブ切り替え
            document.querySelectorAll('.tag-selector .tag').forEach(tag => {
                tag.classList.remove('active');
            });
            document.querySelectorAll('#essential, #database, #authentication, #testing, #ui, #utility').forEach(panel => {
                panel.classList.remove('active');
            });
            
            event.target.classList.add('active');
            document.getElementById(contentId).classList.add('active');
        }
        
        function showContent(contentId) {
            // 汎用コンテンツ切り替え
            if (contentId === 'ruby-basics') {
                showMainContent('ruby-syntax');
            }
        }
        
        // プログレスバー更新
        function updateProgressBar() {
            const sections = document.querySelectorAll('.content-section');
            const activeIndex = Array.from(sections).findIndex(section => 
                section.classList.contains('active')
            );
            const progress = ((activeIndex + 1) / sections.length) * 100;
            document.getElementById('progressBar').style.width = `${progress}%`;
        }
        
        // スクロール時のプログレスバー更新
        window.addEventListener('scroll', () => {
            const winScroll = document.body.scrollTop || document.documentElement.scrollTop;
            const height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
            const scrolled = (winScroll / height) * 100;
            document.getElementById('progressBar').style.width = scrolled + "%";
        });
        
        // 初期プログレスバー設定
        updateProgressBar();
        
        // ページ読み込み時のアニメーション
        window.addEventListener('load', function() {
            const sections = document.querySelectorAll('.section');
            sections.forEach((section, index) => {
                section.style.animationDelay = `${index * 0.1}s`;
            });
        });
        
    </script>
</body>
</html>